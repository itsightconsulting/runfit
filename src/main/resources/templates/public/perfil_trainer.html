<!DOCTYPE html>
<html lang="en" id="extr-page"
      xmlns:th="http://www.thymeleaf.org"
      th:with="version = ${#servletContext.getAttribute('version')}">
<head>
  <title>Perfil trainer específico | Fitness | Runfit</title>
  <th:block th:insert="html-commons/p/meta :: fg-meta"></th:block>
  <th:block th:insert="html-commons/p/css  :: fg-css"></th:block>
</head>
  <body>
    <nav th:replace="html-commons/p/header :: fg-header"></nav>
    <div th:replace="html-commons/reu-login :: fg-login"></div>
    <div id="wrapper">
      <div class="section banner home">
          <div class="bg-image-x">
              <img class="banner-home" th:src="@{/img/public/trainers-shadow.jpg}+'?'+${version}"/>
        </div>
      </div>
      <section class="trainers-form">
        <div class="row">
          <div class="container">
            <div class="col-md-5">
              <div class="avatar-form">
                <div class="avatar-form-content" id="ImagenPerfil"><img src="https://media1.tenor.com/images/b18603537d3dbdd776f2907e3187a5c4/tenor.gif?itemid=11580546" style="max-height: 100% !important;height: 100%"/></div>
              </div>
              <fieldset class="rating hidden">
                  <div class="rating-holder" style="padding: 0px;padding-left: 45px;">
                      <div id="Valoracion" class="c-rating c-rating--regular" data-rating-value="">
                          <button disabled="disabled">1</button>
                          <button disabled="disabled">2</button>
                          <button disabled="disabled">3</button>
                          <button disabled="disabled">4</button>
                          <button disabled="disabled">5</button>
                      </div>
                  </div>
              </fieldset>
              <p class="valoration hidden" id="RestanteValoracion"></p>
            </div>
            <div class="col-md-7">
              <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#about"><span>ACERCA DE MÍ</span></a></li>
                <li class="hidden"><a data-toggle="tab" href="#contact"><span>CONTACTO</span></a></li>
                <li class="hidden"><a data-toggle="tab" href="#staff"><span>STAFF</span></a></li>
                <li><a data-toggle="tab" href="#service"><span>SERVICIOS</span></a></li>
              </ul>
              <div class="tab-content">
                <div class="tab-pane fade in active" id="about">
                  <form>
                    <div class="form-group">
                      <label>NOMBRE</label>
                      <p id="NombreFull"></p>
                    </div>
                    <div class="form-group hidden" id="txtSexo">
                          <label>SEXO</label>
                          <p id="Sexo"></p>
                    </div>
                    <div class="form-group" id="dvEspecialidad">
                      <label>ESPECIALIDAD</label>
                      <p id="Especialidad"></p>
                    </div>
                    <div class="form-group">
                      <label>DEPORTE O ACTIVIDADES QUE REALIZAS</label>
                      <ul id="Disciplinas" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group">
                      <label>ACERCA DE MI</label>
                      <p id="Acerca"></p>
                    </div>
                    <div class="form-group">
                      <label>IDIOMAS QUE DOMINO</label>
                      <p id="Idiomas"></p>
                    </div>
                    <div class="form-group" id="dvEstudios">
                      <label>ESTUDIOS Y CERTIFICACIONES</label>
                      <ul id="Estudios" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group">
                      <label>MÉTODO DE TRABAJO</label>
                      <p id="MetodoTrabajo"></p>
                    </div>
                    <div class="form-group" id="dvExperiencias">
                      <label>EXPERIENCIA LABORAL</label>
                      <ul id="Experiencias" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group">
                      <label>RESULTADOS OBTENIDOS COMO PROFESIONAL</label>
                      <ul id="Resultados" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group">
                      <label>SELECCIONA EL NIVEL DE RENDIMIENTO DE LAS PERSONAS QUE ASESORAS</label>
                      <ul id="Niveles" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group" id="dvCentroTrabajo">
                      <label>CENTRO DE TRABAJO</label>
                      <p id="CentroTrabajo"></p>
                    </div>
                    <div class="form-group hidden" id="lblRangoMapa">
                        <label>RANGO DE ATENCIÓN PRESENCIAL</label>
                        <div class="map" id="map"></div>
                    </div>
                    <div class="form-group" id="dvEspecialidades">
                      <label>ESPECIALIDADES QUE DOMINO</label>
                      <ul id="Especialidades" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group">
                      <label>FORMA DE TRABAJO</label>
                      <ul id="FormasTrabajo" class="list-description">
                      </ul>
                    </div>
                    <div class="form-group" id="dvHorario">
                        <label>HORARIO LABORAL</label>
                        <p id="Horario">
                    </div>
                    <div class="form-group hidden" id="lblGaleriaFotos">
                      <label>GALERÍA DE FOTOS</label>
                      <div class="row">
                        <div class="col-md-12" id="ImgsGaleria">
                        </div>
                      </div>
                    </div>
                    <div class="form-group hidden" id="lblRedes">
                        <label>REDES SOCIALES</label>
                        <div class="form-group rs">
                            <div class="col-xs-12 no_padding">
                                <a href="#" target="_blank" id="RsFb"><img th:src="@{/img/public/fb.png} +'?'+ ${version}"/></a>
                                <a href="#" target="_blank" id="RsIn"><img th:src="@{/img/public/ins.png} +'?'+ ${version}"/></a>
                                <a href="#" target="_blank" id="RsYo"><img th:src="@{/img/public/youtube.png} +'?'+ ${version}"/></a>
                            </div>
                        </div>
                    </div>
                    <div th:if="${porAprobar}" class="form-group">
                        <button class="btn btn-default btn-black btnNextTab" type="button">SIGUIENTE</button>
                    </div>
                  </form>
                </div>
                <div class="tab-pane fade" id="contact">
                      <form id="frm_contacto">
                          <h1 class="title-form">COMPÁRTENOS TUS DATOS PARA CONTACTARNOS LO ANTES POSIBLE</h1>
                          <div class="form-group">
                              <div class="pad-right-middle">
                                  <label>NOMBRE COMPLETO<span class="obligatorio">*</span></label>
                                  <input id="Nombre" name="Nombre" class="form-control" type="text">
                              </div>
                          </div>
                          <div class="form-group">
                              <label>¿CUÁL ES TU GÉNERO?<span class="obligatorio">*</span></label>
                              <ul class="checks">
                                  <li>
                                      <div class="chk-content">Masculino
                                          <input name="Sexo" data-aka="¿CUÁL ES TU SEXO?" type="radio" value="1"><span class="checkmark"></span>
                                      </div>
                                  </li>
                                  <li>
                                      <div class="chk-content">Femenino
                                          <input name="Sexo" type="radio" value="2"><span class="checkmark"></span>
                                      </div>
                                  </li>
                              </ul>
                          </div>
                          <div class="form-group">
                              <div class="pad-right-middle">
                                  <label>CORREO ELECTRÓNICO<span class="obligatorio">*</span></label>
                                  <input id="Correo" name="Correo" class="form-control" type="text">
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="pad-right-middle">
                                  <label>MÓVIL<span class="obligatorio">*</span></label>
                                  <input id="Movil" name="Movil" class="form-control" type="text">
                              </div>
                          </div>
                          <div class="form-group">
                              <label>CUÉNTANOS EN QUÉ TE PODEMOS AYUDAR<span class="obligatorio">*</span></label>
                              <textarea id="Mensaje" name="Mensaje" class="form-control"></textarea>
                          </div>
                          <button id="btnInfoContacto" class="btn btn-default btn-black" type="button">ENVIAR</button>
                      </form>
                  </div>
                  <div class="tab-pane fade" id="staff" style="padding: 0px 0px 20px">
                      <form>
                          <h1 class="title-form">DALE UN VISTAZO A NUESTROS ASESORES</h1>
                          <div>
                              <ul class="staff" id="Staffs">
                              </ul>
                          </div>
                      </form>
                  </div>
                <div class="tab-pane fade" id="service">
                      <h1 class="title-form">DALE UN VISTAZO A NUESTROS SERVICIOS </h1>
                      <form>
                          <div class="ver-servicios">
                              <div id="NomServicios" class="form-group">
                              </div>
                          </div>
                          <div class="form-group">
                              <label>DESCRIPCIÓN</label>
                              <p id="DescripcionServicio"></p>
                          </div>
                          <div class="form-group" id="MainIncluyeServicios">
                              <label>QUE INCLUYE</label>
                              <ul id="IncluyeServicio" class="list-counter">
                                  <li></li>
                              </ul>
                          </div>
                          <div class="form-group">
                              <label>INFORMACIÓN ADICIONAL</label>
                              <p id="InfoAdicional"></p>
                          </div>
                          <div id="EnlaceTYC" class="form-group hidden">
                            <label>TÉRMINOS Y CONDICIONES:
                                <a href="#"><i rel="tooltip" title="Ver términos y condiciones" class="fa fa-fw fa-eye" data-target="#modalTYC" data-toggle="modal"></i></a>
                            </label>
                          </div>
                          <!-- TARIFARIOS -->
                          <h4 id="CabeceraTarifarios" class="sub-title">TARIFARIOS</h4>
                          <div class="row">
                              <div class="col col-md-12 text-center" id="Tarifarios">
                              </div>
                          </div>
                          <!-- DETALLE PAQUETE -->
                          <div class="clase-tarifario collapse in" id="contentTarifario">
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>NOMBRE PAQUETE:</label>
                                      </div>
                                      <div class="col-xs-5">
                                          <label id="NombreTarifario" class="txt-tarifario-right"></label>
                                      </div>
                                  </div>
                              </div>
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>FRECUENCIA:</label>
                                      </div>
                                      <div class="col-xs-5">
                                          <label id="FrecuenciaPaquete" class=" txt-tarifario-right"></label>
                                      </div>
                                  </div>
                              </div>
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>CANTIDAD DE PERSONAS:</label>
                                      </div>
                                      <div class="col-xs-5 text-right">
                                        <label id="txtCantidadPersonas" class="txt-tarifario-right" type="text">0</label>
                                      </div>
                                  </div>
                              </div>
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>CANTIDAD DE MESES:</label>
                                      </div>
                                      <div class="col-xs-5 text-right">
                                        <label id="txtCantidadMeses" class="txt-tarifario-right" type="text">0</label>
                                      </div>
                                  </div>
                              </div>
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>CANTIDAD DE SESIONES:</label>
                                      </div>
                                      <div class="col-xs-5 text-right">
                                        <label id="txtCantidadSesiones" class="txt-tarifario-right" type="text">0</label>
                                      </div>
                                  </div>
                              </div>
                              <div class="form-group txt-tar">
                                  <div class="row">
                                      <div class="col-xs-7">
                                          <label>PRECIO TOTAL:</label>
                                      </div>
                                      <div class="col-xs-5 text-right">
                                          <label id="PrecioPaquete" class="txt-tarifario-right" type="text" value="0.00"></label>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <!-- END DETALLE PAQUETE -->
                          <!-- END TARIFARIOS-->
                          <h4 class="title-metodo-pago">INFORMACIÓN DE PAGO</h4>
                          <div class="steps">
                              <div class="row">
                                  <ol>
                                      <li class="efectivo">
                                          <div class="form-group li-perfil-asesor">
                                              <label>EFECTIVO: <i class="fa fa-check-circle"></i></label>
                                          </div>
                                      </li>
                                      <li class="cuentas-bancarias">
                                          <div class="form-group li-perfil-asesor">
                                              <label>TRANSFERENCIAS: <a href="javascript:void(0);" style="color: black"><i class="fa fa-chevron-down" onclick="verCuentasBancariasNoOps();"></i></a></label>
                                          </div>
                                      </li>
                                      <li class="tarjetas">
                                          <div class="form-group li-perfil-asesor">
                                              <label>TARJETAS:</label>
                                              <div class="row">
                                                  <div class="col col-md-12" id="MediosPagosAgregados" style="padding-bottom:15px">
                                                      <a href="javascript:void(0);" class="cc-elegido hidden" data-id="2"><img th:src="@{/img/mastercard.png}"></a>
                                                      <a href="javascript:void(0);" class="cc-elegido hidden" data-id="3"><img th:src="@{/img/visa.png}"></a>
                                                      <a href="javascript:void(0);" class="cc-elegido hidden" data-id="4"><img th:src="@{/img/amex.png}"></a>
                                                      <a href="javascript:void(0);" class="cc-elegido hidden" data-id="5"><img th:src="@{/img/diners-club.png}"></a>
                                                      <a href="javascript:void(0);" class="cc-elegido hidden" data-id="6"><img th:src="@{/img/discover.png}"></a>
                                                  </div>
                                              </div>
                                          </div>
                                      </li>
                                  </ol>
                              </div>
                          </div>
                          <div class="form-group hidden" id="divNotaFinal">
                              <label>Nota</label>
                              <p id="NotaFinal"></p>
                          </div>
                          <div th:if="${porAprobar}" class="form-group div-aprobacion">
                              <input id="HshTrainerId" type="hidden" th:value="${hshTrainerId}">
                              <button class="btn btn-default btn-black" id="btnAprobarTrainer"><i class="fa fa-check"></i>APROBAR</button>
                              <button class="btn btn-default btn-white" id="btnAbrirCajaNotificacion">NOTIFICAR CORRECCIÓN</button>
                              <div class="hidden" id="SeccionCorreccion">
                                  <textarea id="Obs" class="form-control" placeholder="Escribir los puntos a modificar" style="margin-bottom: 15px"></textarea>
                                  <div style="text-align: right">
                                      <a href="javascript:void(0)" onclick="enviarInfoACorregir()" class="btn btn-success" style="background-color: #303030;border: none;">
                                          <i class="fa fa-fw fa-paper-plane"></i>ENVIAR</a>
                                  </div>
                              </div>
                          </div>
                          <button id="btnElegir" class="btn btn-default btn-black hidden" type="button">INSCRÍBETE</button>
                      </form>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <!-- MODALS -->
    <th:block th:insert="public/modals-trainer :: fg-modals-p-trainer"></th:block>
    <footer th:replace="html-commons/p/footer :: fg-footer"></footer>
    <th:block th:insert="html-commons/p/js :: fg-js"></th:block>
    <script th:src="@{/js/hashids.min.js}+'?'+${version}"></script>
    <script async="" defer="" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPnQe-1f0b5KmTQXUMED0_n9-Vx3Y4ixc&amp;callback=initMap" type="text/javascript"></script>
    <script th:inline="javascript">
      let $perfil = {};
      const btnElegir = document.getElementById('btnElegir');
      const btnInfoContacto = document.getElementById('btnInfoContacto');
      const btnAprobarTrainer = document.getElementById('btnAprobarTrainer');
      const btnAbrirCajaNotificacion = document.getElementById('btnAbrirCajaNotificacion');
      const tabService = document.getElementById('service');
      const body = document.querySelector('body');
      const frm = document.getElementById('frm_contacto');
      let ccBancarias = [];
      let servicios = [];
      let selServicioId = -1;


      (function () {
          btnElegir.addEventListener('click', irARegistro);
          btnInfoContacto.addEventListener('click', registrarContactoTrainer);
          tabService.addEventListener('click', clickListenerTabService);
          body.addEventListener('click', bodyClickEventListener);
          body.addEventListener('focusout', bodyFocusOutEventListener);
          if(btnAprobarTrainer !== null){
              btnAprobarTrainer.addEventListener('click', aprobacionFinalTrainer);
              btnAbrirCajaNotificacion.addEventListener('click', (e)=>{
                  e.preventDefault();
                  document.getElementById('SeccionCorreccion').classList.remove('hidden');
              });
          }
          init();
      })();

      function clickListenerTabService(e) {
          const input = e.target;
          const clases = input.classList;
          if (clases.contains('servicio')) {
              const id = input.getAttribute('data-id');
              selServicioId = Number(id);
              const svcFocus = tabService.querySelector('.svc-focus');
              svcFocus != undefined ? svcFocus.classList.remove('svc-focus') : "";
              clases.add('svc-focus');
              mostrarDetalleServicio(selServicioId);
          } else if (clases.contains('cc-bancaria')) {
              const inputBancoId = document.getElementById('ModalCuentaBancoId');
              const ccId = Number(input.getAttribute('data-id'));
              inputBancoId.value = ccId;
              const d = ccBancarias.find(e => e.bancoId === ccId);
              $('#myModalCC').modal('show');
              const dC = document.getElementById('CuentaBancariaUnica');
              dC.querySelector('.cc-nom-banco').textContent = banks.find(b=>b.id===d.bancoId).nombre;
              dC.querySelector('.cc-titular').textContent = d.titular;
              dC.querySelector('.cc-cs').textContent = d.numeroSoles;
              dC.querySelector('.cc-cis').textContent = d.interbancarioSoles;
          } else if(clases.contains('tarifa-svc')) {
              let padre = {};
              if(input.tagName === "IMG" || input.tagName === "H6"){
                  padre = input.parentElement.parentElement;
              } else if(input.tagName === "A"){
                  padre = input.parentElement;
              }
              const svcFocus = tabService.querySelector('.tarifa-svc-pick');
              svcFocus != undefined ? svcFocus.classList.remove('tarifa-svc-pick') : "";
              padre.classList.add('tarifa-svc-pick');
              mostrarDetalleTarifaSvc(Number(padre.getAttribute('data-id')));
          }
      }

      function mostrarDetalleTarifaSvc(tarifaId){
          const t = servicios.find(v => v.id === selServicioId).tarifarios.find((t, ix)=>ix === tarifaId);
          document.querySelector('#NombreTarifario').textContent = t.nombre;
          document.querySelector('#FrecuenciaPaquete').textContent = t.frecuencia;
          document.querySelector('#txtCantidadPersonas').textContent = t.personas;
          document.querySelector('#txtCantidadMeses').textContent = t.meses;
          document.querySelector('#txtCantidadSesiones').textContent = t.sesiones;
          document.querySelector('#PrecioPaquete').textContent = (t.monedaId === 1 ? 'S/. ' : '$ ')+ parseFloat(t.precio).toFixed(2);
      }

      function mostrarDetalleServicio(servicioId){
          const svc = servicios.find(e=>e.id===servicioId);
          document.querySelector('#DescripcionServicio').innerHTML = svc.descripcion.replace(/\r?\n/g, '<br />');
          const infoAdicional = document.getElementById('InfoAdicional');
          infoAdicional.innerHTML = svc.infoAdicional ? svc.infoAdicional.replace(/\r?\n/g, '<br />') : infoAdicional.parentElement.classList.add('hidden');
          if(svc.infoAdicional){
              infoAdicional.parentElement.classList.remove('hidden');
          }
          setIncluyeDelServicio(svc.incluye);
          setFileTermCond(svc);
          setTarifarios(svc.tarifarios);
      }

      function setFileTermCond(svc){
          if(svc.tycFile){
              document.getElementById('EnlaceTYC').classList.remove('hidden');
              const doc = document.createElement('embed');
              doc.type = "application/pdf";
              doc.style = "width: 100%; height: 100%";
              if(empTrainerId>0){
                  doc.src = 'https://s3-us-west-2.amazonaws.com/rf-profile-imgs/trainer/'+empTrainerId+"/"+svc.tycFile;
              }else{
                  doc.src = 'https://s3-us-west-2.amazonaws.com/rf-profile-imgs/trainer/'+$perfil.id+"/"+svc.tycFile;
              }
              document.getElementById('TYC').innerHTML = "";
              document.getElementById('TYC').appendChild(doc);
          } else {
              document.getElementById('EnlaceTYC').classList.add('hidden');
          }
      }

      function setTarifarios(tarifarios){
          const dt = document.getElementById('Tarifarios');
          dt.innerHTML = "";
          if(!tarifarios.length){
              document.querySelector('#contentTarifario').classList.add('hidden');
              document.querySelector('#CabeceraTarifarios').classList.add('hidden');
          }else{
              document.querySelector('#contentTarifario').classList.remove('hidden');
              document.querySelector('#CabeceraTarifarios').classList.remove('hidden');
          }
          tarifarios.forEach((t,ix)=>{
              t.id = ix;
              dt.appendChild(
                  htmlStringToElement(`${putTarifario(t.id, t.nombre)}`));
          });

          if($('#Tarifarios .tarifa-svc')[0]){
              $('#Tarifarios .tarifa-svc')[0].click();
          }
      }

      function putTarifario(id, nombre){
          setTimeout(()=>{
              $(tabService.querySelector(`#Tarifarios a.edit[data-id="${id}"]`)).tooltip();
          }, 500);
          return `<div class="col-md-3 col-xs-4 mg-bt-10" data-id="${id}">
                        <a href="javascript:void(0)" class="tarifa-svc">
                            <img class="tarifa-svc" src="${_ctx}img/purchase.svg"/>
                            <h6 class="tarifa-svc">${nombre}</h6>
                        </a>
                    </div>`
      }

      function setIncluyeDelServicio(incluidos){
          incluidos = incluidos.split("|");
          const mainIncluidos = document.querySelector('#IncluyeServicio');
          mainIncluidos.innerHTML = "";
          incluidos.forEach(e=>{
              mainIncluidos.appendChild(htmlStringToElement(`<li>${e.replace(/\r?\n/g, '\n')}</li>`));
          });
      }

      function bodyClickEventListener(e){
          const input = e.target;
          const clases = input.classList;
          checkBoxAndRadioValidationEventListener(e, input, clases);
      }

      function init(){
        getTrainer();
        checkFrom();
        constraintsValidation();
        setHeightForModals(['myModalCC']);
        setEstilosParaModalGaleria();
        nextTabButton();
      }

      function nextTabButton() {
          $('.btnNextTab').click(function(){
              const header = $(".navbar-inverse").height();
              $('html, body').animate({scrollTop: $('.nav-tabs').offset().top - header - 20}, 'slow');
              setTimeout(() => {
                  document.querySelector('a[href="#service"]').click();
              }, 300);
          });
      }

      function checkFrom(){
          const onlyCheckPerfilTrainerDeEmpresa = getParamFromURL('den');
          if(onlyCheckPerfilTrainerDeEmpresa){
              document.querySelector('#btnElegir').classList.add('hidden');
          }else{
              if(btnAprobarTrainer === null){
                  document.querySelector('.rating').classList.remove('hidden');
                  document.querySelector('.valoration').classList.remove('hidden');
                  $('.nav-tabs a[href="#contact"]').parent()[0].classList.remove('hidden');
              }else{
                  document.querySelector('#btnInfoContacto').classList.add('hidden');
                  document.querySelector('#btnElegir').classList.add('hidden');
                  document.querySelector('#txtSexo').classList.remove('hidden');
                  disabledForm('frm_contacto');
              }
          }

      }

      function checkTab(){
          const tabHref = window.location.href.substring(window.location.href.indexOf("#"));
          if(!tabHref.includes('http')){
              const e = document.querySelector(`li a[href="${tabHref}"]`);
              if(e != null){
                e.click();
                  setTimeout(() => {
                      $(window).scrollTop(100);
                  }, 501);
              }
          }
      }

      function irARegistro(){
        const hshId = $perfil.hshTrainerId;
        const trainerCorreo = csBtoa($perfil.correo).replace(/\=/g,'');
        const fichaIds = $perfil.fichaClienteIds.split("|");
        const svcId = csBtoa(selServicioId);

        if(fichaIds.length==1){
            //Checking if user is login or is new
            const flagUserLogged = document.getElementById('logout_flag');
            if(flagUserLogged){
                window.location.href = _ctx + "gestion/cliente/inscripcion/servicio="+hshId+"&ml="+trainerCorreo+"&sid="+svcId;
            }else{
                const id = fichaIds[0];
                if(id === "1"){
                    window.location.href = _ctx + "p/ficha-inscripcion?key="+hshId+"&ml="+trainerCorreo+"&sid="+svcId;
                }else if(id === "2"){
                    window.location.href = _ctx + "p/ficha-inscripcion/general?key="+hshId+"&ml="+trainerCorreo+"&sid="+svcId;
                }
            }
        }else{
            $.SmartMessageBox({
                title: "<i class='fa fa-exclamation-triangle fa-fw' style='color:yellow;'></i> <b>RUNFIT</b>",
                content: "<div style='font-size: 1.3em'>Antes de ir al formulario de registro, deseamos saber, ¿El servicio elegido está relacionado con la disciplina de running?</div>",
                buttons: '[NO][SI]'
            }, function (ButtonPressed) {
                if(ButtonPressed == 'SI'){
                    window.location.href = _ctx + "p/ficha-inscripcion?key="+hshId+"&ml="+trainerCorreo+"&sid="+svcId;
                }

                if(ButtonPressed == 'NO'){
                    window.location.href = _ctx + "p/ficha-inscripcion/general?key="+hshId+"&ml="+trainerCorreo+"&sid="+svcId;
                }
            })
        }
      }

      function registrarContactoTrainer(){
          if(!$(frm).valid()){
              return;
          }
          const params = getFormData($(frm));
          const inpSexo = document.querySelector('input[name="Sexo"]:checked');
          params.sexo = inpSexo === null ? '': inpSexo.value;
          params.correoTrainer = $perfil.correo;
          const trainerId = $perfil.id;
          $('#btnInfoContacto').attr('disabled', 'disabled');
          const ttId = $perfil.tipoTrainerId;
          const url = _ctx + `p/contacto/trainer/registrar/${trainerId}?ttId=${ttId}`;
          $.ajax({
              type: 'POST',
              contentType: "application/x-www-form-urlencoded; charset=UTF-8",
              url: url,
              dataType: "json",
              data: params,
              blockLoading: true,
              success: function (data, textStatus) {
                  if (textStatus == "success") {
                      reqSuccess(data);
                  }
              },
              error: function (xhr) {
                  $('#btnInfoContacto').removeAttr('disabled');
                  exception(xhr);
              },
              complete: function () {

              }
          });
      }

      function aprobacionFinalTrainer(e){
          e.preventDefault();
          const hshId = document.getElementById('HshTrainerId').value;
          const correo = $perfil.correo;
          $.ajax({
              type: 'POST',
              contentType: "application/x-www-form-urlencoded; charset=UTF-8",
              url: _ctx + 'p/trainer/ultima-aprobacion/'+hshId+'/'+correo,
              dataType: "json",
              data: {tipoTrainerId: $perfil.tipoTrainerId},
              blockLoading: true,
              success: function (data, textStatus) {
                  if (textStatus == "success") {
                      reqSuccess(data);
                      document.querySelector('.div-aprobacion').classList.add('hidden');
                  }
              },
              error: function (xhr) {
                  exception(xhr);
              },
              complete: function () {
              }
          });
      }

      function enviarInfoACorregir(){
          const obj = {};
          const hshTrainerId = document.getElementById('HshTrainerId').value;
          obj.hshTrainerId = hshTrainerId;
          obj.correo = $perfil.correo;
          obj.obs = document.getElementById('Obs').value;
          obj.tipoTrainerId = $perfil.tipoTrainerId;

          $.ajax({
              type: 'GET',
              url: _ctx + 'p/trainer/perfil/observaciones',
              dataType: "json",
              data: obj,
              blockLoading: true,
              success: function (data, textStatus) {
                  if (textStatus == "success") {
                      reqSuccess(data);
                      document.querySelector('.div-aprobacion').classList.add('hidden');
                  }
              },
              error: function (xhr) {
                  exception(xhr);
              },
              complete: function () {
              }
          });
      }

      function getTrainer(){
        const urlArr = window.location.href.split("/");
        const nomPag = urlArr[urlArr.length-1];
        let extraPath = urlArr.some(p=>p==="ver" || p==="revision" ) ? 'sec/':'';
        $.ajax({
          type: 'GET',
          url: _ctx + 'p/trainer/get/'+extraPath+nomPag,
          dataType: 'json',
          blockLoading: false,
          success: function (res) {
            $perfil = res;
            recrearPerfil(res);
            getServiciosAsync(res.id, res.tipoTrainerId);
            checkTab();
          }, error: (xhr) => {
             if(xhr.status == 404){
                 window.location.href = _ctx+"p/recurso-no-encontrado";
             }
             exception(xhr);
          }, complete: () => {
          }
        })
      }

      function getServiciosAsync(trainerId, ttId){
          let mainUrl = _ctx+'p/trainer/get/servicios/'+ trainerId + '?tipoTrainerId='+ttId;

          $.ajax({
              type: 'GET',
              url: mainUrl,
              dataType: 'json',
              noOne: true,
              success: function (res) {
                  empTrainerId = res.empresaTrainerId;
                  res = res.servicios;

                  if($perfil.tipoTrainerId === TipoTrainer.DE_EMPRESA){
                      const mines = $perfil.svcIds.split(",");
                      res = mines.map(e=>
                          res.find(s=>s.id===Number(e))
                      );
                  }

                  res.forEach(e => {
                    if(e.tarifarios) {
                        e.tarifarios = JSON.parse(e.tarifarios);
                    }
                  })
                  servicios = res;
                  reconstruirServicios(servicios);
                  setTarifarios(servicios[0].tarifarios)
                  setFileTermCond(servicios[0]);
              }, error: (xhr) => {
                  if (xhr.status == 404) {
                      window.location.href = _ctx + "p/recurso-no-encontrado";
                  }
                  exception(xhr);
              }, complete: () => {
              }
          })
      }

      function checkTabStaff(staffGaleria, id, ttId){
        if(ttId == 1){
            return;
        }
        if(staffGaleria){
            document.querySelector('.nav-tabs a[href="#staff"]').parentElement.classList.remove('hidden');
            const divStaffs = document.getElementById('Staffs');
            const s = staffGaleria;
            const routeArray = window.location.pathname.split('/');
            const fromRutaParaInscripcion = routeArray[3].length >= 8;
            s.split("|").forEach(e=>{
                const imgAndNom = e.split(",");
                //Esta cadena no representa nada en backend, solo es un artificio:
                //vXBwA0END3zjlNmLk5mZKebwbNwLX2veM9aVPdGoq6PEg2d76GZAlDz1jpO5Bx7R
                divStaffs.appendChild(htmlStringToElement(
                    `<li>
                                    <div class="avatar-form-min">
                                        <img class="img-asesor-emp" src="https://s3-us-west-2.amazonaws.com/rf-profile-imgs/trainer/${imgAndNom[0]}"/>
                                    </div>
                                    <a href="${_ctx}p/trainer/${imgAndNom.length === 3 ? imgAndNom[2] : ''}${fromRutaParaInscripcion ? '': '?den=vXBwA0END3zjlNmLk5mZKebwbNwLX2veM9aVPdGoq6PEg2d76GZAlDz1jpO5Bx7R'}" target="_blank"><p>${imgAndNom[1]}</p></a>
                                </li>`
                ))
            })
        }
      }

      function recrearPerfil(t){
        const ttId = t.tipoTrainerId;
        checkTabStaff(t.staffGaleria, t.id, ttId);

        document.querySelector('#ImagenPerfil img').src = 'https://s3-us-west-2.amazonaws.com/rf-profile-imgs/trainer/'+t.id+"/"+t.nomImgPerfil;
        document.querySelector('#Acerca').innerHTML = t.acerca.replace(/\r?\n/g, '<br />');
        let idiomas = t.idiomas.split("|");
        document.querySelector('#Idiomas').appendChild(htmlStringToElement('<ul class="list-description">'+idiomas.map(e=>`<li><p>${_idiomas.find(i=>i.cd===e).nombre}</p></li>`).join('')+'</ul>'));
        setValoracion(t.canPerValoracion, t.totalValoracion);
        document.querySelector('#Sexo').textContent = t.sexo === 1 ? 'Masculino' : 'Femenino';
        document.querySelector('#MetodoTrabajo').innerHTML = t.metodoTrabajo.replace(/\r?\n/g, '<br />');
        if(t.centroTrabajo){
            document.querySelector('#CentroTrabajo').innerHTML = t.centroTrabajo;
        } else {
            $('#dvCentroTrabajo').addClass('hidden');
        }
        let res = document.querySelector('#Resultados');
        reconstruirLista(res, t.resultados);
        let niveles = t.niveles.split("|");
        document.querySelector('#Niveles').appendChild(htmlStringToElement('<ul class="list-description">'+niveles.map(e=>`<li><p>${_niveles.find(i=>i.cd===e).nombre}</p></li>`).join('')+'</ul>'));
        mostrarMediosPago(t.mediosPago, t.cuentas);

        let disciplinas = document.querySelector('#Disciplinas');
        reconstruirLista(disciplinas, t.disciplinas);

        let formsTrabajo = t.formasTrabajo.split("|");
        document.querySelector('#FormasTrabajo').appendChild(htmlStringToElement('<ul class="list-description">'+formsTrabajo.map(e=>`<li><p>${_forsTrabajo.find(i=>i.cd===e).nombre}</p></li>`).join('')+'</ul>'));
        if(ttId === TipoTrainer.PARTICULAR || ttId === TipoTrainer.DE_EMPRESA){
            if(!window.location.href.split("/").find(e=>e==="ver") && !getParamFromURL('den')){
                document.getElementById('btnElegir').classList.remove('hidden');
            }
            document.querySelector('#NombreFull').textContent = t.nombreCompleto;
            document.querySelector('#Especialidad').textContent = t.especialidad;
            let est = document.querySelector('#Estudios');
            reconstruirLista(est, t.estudios);
            let exp = document.querySelector('#Experiencias');
            reconstruirLista(exp, t.experiencias);
            let espc = document.querySelector('#Especialidades');
            reconstruirLista(espc, t.especialidades);
        } else {
            document.querySelector('#NombreFull').textContent = t.nombreCompleto.substr(0, t.nombreCompleto.indexOf(" xxx"));
            document.querySelector('#dvEspecialidad').classList.add('hidden');
            document.querySelector('#dvEstudios').classList.add('hidden');
            document.querySelector('#dvExperiencias').classList.add('hidden');
            document.querySelector('#dvEspecialidades').classList.add('hidden');
            document.querySelector('#txtSexo').classList.add('hidden');
        }

        if(t.horario){
            document.querySelector('#Horario').textContent = t.horario;
        }else{
            document.querySelector('#dvHorario').classList.add('hidden');
        }

        selServicioId = 0;
        checkMapaAndGaleria(t);
        checkRedesAndNota(t);
        if(flag_form_populate){
            populateContactoTabAndObs(t);
        }
      }

      function checkMapaAndGaleria(t){
          const baseSrc = 'https://s3-us-west-2.amazonaws.com/rf-profile-imgs/trainer/'+t.id+"/";
          if(t.miniGaleria != null && t.miniGaleria.trim().length>0){
              document.getElementById('lblGaleriaFotos').classList.remove('hidden');
              const noOptionDelete = true;
              poblarCarusel(t.miniGaleria.split("|"), 'ImgsGaleria', baseSrc, true);
          }

          if(t.mapCoordenadas != null && t.mapCoordenadas.trim().length>0){
              document.getElementById('lblRangoMapa').classList.remove('hidden');
              setTimeout(() => {
                  const allCord = t.mapCoordenadas.split(",");
                  const lat = Number(allCord[0].substr(1));
                  const lng = Number(allCord[1].slice(0, -1));
                  new google.maps.Circle({
                      strokeColor: '#57ff0e',
                      strokeOpacity: 0.8,
                      strokeWeight: 2,
                      fillColor: '#8ee2ff',
                      fillOpacity: 0.35,
                      map: map,
                      center: {lat: lat, lng: lng},
                      radius: Number(t.mapCircleRadio)
                  });
                  map.panTo(new google.maps.LatLng(lat, lng));
              }, 1000);
          }
      }

      function populateContactoTabAndObs(t){
          if(flag_form_populate){
              document.querySelector('#Nombre').value = t.nombreCompleto;
              document.querySelector('#Correo').value = t.correo;
              document.querySelector('#Movil').value = "987654321";
              document.querySelector('#Mensaje').value = "Aloha";
              document.querySelector('input[name="Sexo"]').checked = true;
          }

          const obs = document.getElementById('Obs');
          if(obs != undefined){
              obs.value = "Demostración";
          }
      }

      function reconstruirLista(e, stringArr){
          if(stringArr){
              stringArr.split("|").forEach(v => e.appendChild(htmlStringToElement(`<li><p>${v.trim()}</p></li>`)));
          }else{
            //
          }
      }

      function reconstruirServicios(servicios){
          const dvServicios = document.getElementById('NomServicios');
          dvServicios.innerHTML = servicios.map((e, ix) => `<label class="servicio ${ix===0 ? 'svc-focus':''}" data-id="${e.id}">${e.nombre}</label>`).join('');
          const fSs = servicios[0];
          document.getElementById('DescripcionServicio').innerHTML =  fSs.descripcion.replace(/\r?\n/g, '<br />');
          const dvIncServicio = document.getElementById('IncluyeServicio');
          dvIncServicio.innerHTML = fSs.incluye.split("|").map((e) => `<li>${e}</li>`).join('');
          const infoAdicional = document.getElementById('InfoAdicional');
          infoAdicional.innerHTML = servicios[0].infoAdicional ? servicios[0].infoAdicional.replace(/\r?\n/g, '<br />') : infoAdicional.parentElement.classList.add('hidden');
          selServicioId = fSs.id;
      }

      function reconstruirCuentaBanco(cuentas){
          cuentas = JSON.parse(cuentas);
          if(cuentas.length>0){
              const pc = cuentas[0];
              document.getElementById('CuentaBanco').appendChild(htmlStringToElement(`<table class="table">
                                      <thead>
                                      <tr>
                                          <th>MONEDA</th>
                                          <th>CUENTA AHORROS</th>
                                          <th>CÓDIGO INTERBANCARIO</th>
                                      </tr>
                                      </thead>
                                      <tbody>
                                      <tr>
                                          <td><strong>Soles</strong></td>
                                          <td><strong>${pc.numeroSoles}</strong></td>
                                          <td><strong>${pc.interbancarioSoles}</strong></td>
                                      </tr>
                                      <tr>
                                          <td><strong>Dólares</strong></td>
                                          <td><strong>${pc.numeroDolares}</strong></td>
                                          <td><strong>${pc.interbancarioDolares}</strong></td>
                                      </tr>
                                      <tr>
                                          <td><strong>Títular</strong></td>
                                          <td>${pc.titular}</td>
                                          <td></td>
                                      </tr>
                                      <tr>
                                          <td><strong>Banco</strong></td>
                                          <td>${banks.find(e=>e.id==pc.bancoId).nombre}</td>
                                          <td></td>
                                      </tr>
                                      <tr>
                                          <td><strong>${pc.titularTipoDoc}</strong></td>
                                          <td>${pc.titularNumDoc}</td>
                                          <td></td>
                                      </tr>
                                      </tbody>
                                  </table>
          `));
          }
      }

      function reconstruirTarifario(tarifas){
          if(tarifas && tarifas.length){
              tarifas.forEach((t, ix)=>{
                  t.id = ix;
                  document.getElementById('Tarifarios').appendChild(htmlStringToElement(`
                            <div class="col-md-3 col-xs-4 mg-bt-10" data-id="${t.id}">
                                <a href="javascript:void(0)" class="tarifa-svc">
                                    <img class="tarifa-svc" src="${_ctx}img/purchase.svg"/>
                                    <h6 class="tarifa-svc">${t.nombre}</h6>
                                </a>
                            </div>`))});
          }
      }

      function mostrarMediosPago(mediosPago, cuentas){
        //Pasando las cuentas al aray que posteriormente será usado para poblar el modal de cuentas
        let noOne = true;
        if(cuentas){
            const ccs = JSON.parse(cuentas);
            if(ccs.length){
                noOne = false;
                //Importante para que en el modal no aparezca el ícono imagen de eliminar
                ccs[0].noDelete = true;
                ccBancarias = ccs;
            }else{
                document.querySelector('.cuentas-bancarias').remove();
            }
        }else{
            document.querySelector('.cuentas-bancarias').remove();
        }

        const ccs = mediosPago ? mediosPago.split("|") : [];
        ccs.forEach(id=>{
            noOne = false;
            if(id != "1"){
                tabService.querySelector('.cc-elegido[data-id="'+id+'"]').classList.remove('hidden');
            }
        });
        if(!ccs.find(e=>e=="1")){
            document.querySelector('.efectivo').remove();
        }
        if(!ccs.find(e=>e!="1")){
            document.querySelector('.tarjetas').remove();
        }

        if(noOne){
            document.querySelector('.title-metodo-pago').classList.add('hidden');
        }

        number_time_line();
      }

      function setValoracion(canPerValoracion, totalValoracion){
          const objValoracion = getValoracion(canPerValoracion, totalValoracion);
          document.querySelector('#Valoracion').setAttribute('data-rating-value', objValoracion.aproximadaValoracion);
          const res = document.getElementById('RestanteValoracion');
          res.innerHTML = `
                ${objValoracion.exactaValoracion.toFixed(1)}<span> (${objValoracion.valoraciones} valoraciones)</span>
          `;
      }

      function constraintsValidation() {

          $('#frm_contacto').validate({
              rules: {
                  Nombre: {
                      required: true,
                      rangelength: [5, 60],
                      lettersonly: true
                  },
                  Correo: {
                      required: true,
                      emailAddress: true,
                      rangelength: [7, 40]
                  },
                  Movil: {
                      required: true,
                      digits: true,
                      rangelength: [7, 13]
                  },
                  Mensaje: {
                      required: true,
                      rangelength: [4, 1000],
                  },
                  Sexo:{
                      required: true
                  }
              },
              messages:{}
          });

          const rules = $(frm).validate().settings.rules;
          Object.keys(rules).filter(e=>rules[e].hasOwnProperty('rangelength')).forEach(e=>{
              document.getElementById(e).setAttribute('maxlength', rules[e].rangelength[1]);
          });
      }

    </script>
  </body>
</html>
