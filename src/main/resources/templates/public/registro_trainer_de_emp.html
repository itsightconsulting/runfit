<!DOCTYPE html>
<html lang="en" id="extr-page"
      xmlns:th="http://www.thymeleaf.org"
      th:with="version = ${#servletContext.getAttribute('version')}">
  <head>
    <title>Inscripción de entrenadores | Fitness | Runfit</title>
    <th:block th:insert="html-commons/p/meta :: fg-meta"></th:block>
    <th:block th:insert="html-commons/p/css  :: fg-css"></th:block>
    <link rel="stylesheet" type="text/css" th:href="@{/css/public/cropper.min.css}+'?'+${version}"/>
  </head>
  <body>
      <nav th:replace="html-commons/p/header :: fg-header"></nav>
      <div th:replace="html-commons/reu-login :: fg-login"></div>
      <div id="wrapper">
          <div class="section banner home">
              <div class="bg-image-x"><img class="banner-home" th:src="@{/img/public/trainers-shadow.jpg}"></div>
          </div>
          <section class="trainers-form">
              <div class="row">
                  <div class="container">
                      <div class="col-md-5">
                          <div class="avatar-form">
                              <input type="file" id="InpImgPerfil">
                              <div class="avatar-form-content img-container">
                                  <img id="FinalImagenRecortada" title="Subir foto" onclick="javascript:document.getElementById('InpImgPerfil').click()" th:src="@{/img/public/subir_foto.png}" style="height: 220px;"/>
                                  <i id="btnVerPerEmpresa" rel="tooltip" title="Si desea volver al perfil de empresa, clickee aquí" style="float:right; color: #17a2b8;font-size: 1.5em;cursor: pointer;" class="fa fa-arrow-circle-left"></i>
                              </div>
                          </div>
                      </div>
                      <div class="col-md-7">
                          <ul class="nav nav-tabs">
                              <li class="active"><a class="step step-01" data-num-sheet="1" onclick="next_step_cs_rt(1)"><span>ACERCA DE MÍ</span></a></li>
                              <li><a class="step step-02" data-num-sheet="2" onclick="next_step_cs_rt(2)"><span>CONTACTO</span></a></li>
                              <li><a class="step step-03" data-num-sheet="3" onclick="next_step_cs_rt(3)"><span>SERVICIOS</span></a></li>
                          </ul>
                          <form id="frm_registro">
                              <div class="tab-content">
                                  <div class="tab-pane fade in inpts-1" id="about">
                                      <div class="form-group">
                                          <div class="">
                                              <label>NOMBRE(S)<span class="obligatorio">*</span></label>
                                              <input class="form-control" name="Nombres" id="Nombres" data-aka="Nombres" type="text">
                                          </div>
                                          <div class="">
                                              <label>APELLIDO(S)<span class="obligatorio">*</span></label>
                                              <input class="form-control" name="Apellidos" id="Apellidos" data-aka="Apellidos" type="text">
                                          </div>
                                          <div class="pad-right-middle" style="width: 100%">
                                              <label>SEXO<span class="obligatorio">*</span></label>
                                              <ul class="checks">
                                                  <li>
                                                      <div class="chk-content">Masculino
                                                          <input name="Sexo" data-aka="SEXO" value="1" type="radio"><span class="checkmark"></span>
                                                      </div>
                                                  </li>
                                                  <li>
                                                      <div class="chk-content">Femenino
                                                          <input name="Sexo" value="2" data-aka="Seleccionar sexo" type="radio"><span class="checkmark"></span>
                                                      </div>
                                                  </li>
                                              </ul>
                                          </div>
                                      </div>
                                      <div class="form-group">
                                          <label>ESPECIALIDAD<span class="obligatorio">*</span></label>
                                          <input class="form-control" name="Especialidad" id="Especialidad" data-aka="Especialidad" type="text">
                                      </div>
                                      <div class="form-group">
                                          <label>DEPORTE O ACTIVIDADES QUE REALIZAS<span class="obligatorio">*</span></label>
                                          <input class="form-control mg-bt-10 inp-disciplina" id="Disciplinas" name="Disciplinas" type="text" placeholder="Ej: Running"/>
                                          <a href="javascript:void(0);" class="add" onclick="javascript:agregarInputDinamico(this, 20, 'inp-disciplina', 80)"><i title="Agregar" class="fa fa-15x fa-plus pull-right"></i></a>
                                      </div>
                                      <div class="form-group">
                                          <label>ACERCA DE MÍ<span class="obligatorio">*</span></label>
                                          <textarea class="form-control" id="Acerca" name="Acerca" data-aka="Acerca de mí"></textarea>
                                      </div>
                                      <div class="form-group">
                                              <div class="pad-right-middle" style="width:100%;">
                                                  <label>IDIOMAS<span class="obligatorio">*</span></label>
                                                  <select class="form-control hidden" data-aka="Idiomas" multiple="multiple" id="Idiomas" name="Idiomas"></select>
                                              </div>
                                              <div class="form-group" id="Estudios">
                                                  <label>ESTUDIOS Y CERTIFICACIONES<span class="obligatorio">*</span></label>
                                                  <input class="form-control mg-bt-10 inp-estudio" id="EstudiosCertificaciones" name="EstudiosCertificaciones" type="text" placeholder="Ejem: Licenciado en cultura física y deporte"/>
                                                  <a href="javascript:void(0);" class="add" onclick="javascript:agregarInputDinamico(this, 20, 'inp-estudio', 90)"><i title="Agregar" class="fa fa-15x fa-plus pull-right"></i></a>
                                              </div>
                                              <div class="form-group">
                                                  <label>MÉTODO DE TRABAJO<span class="obligatorio">*</span></label>
                                                  <textarea style="overflow: auto" class="form-control" rows="4" type="text" id="MetodoTrabajo" name="MetodoTrabajo"></textarea>
                                              </div>
                                              <div class="form-group" id="ExpLaboral">
                                                  <label>EXPERIENCIA LABORAL<span class="obligatorio">*</span></label>
                                                  <input class="form-control mg-bt-10 inp-experiencia" id="Experiencias" name="Experiencias" type="text" placeholder="Ejem: Entrenador en AquaLab (2013 – hasta la fecha)"/>
                                                  <a href="javascript:void(0);" class="add" onclick="javascript:agregarInputDinamico(this, 20, 'inp-experiencia', 90)"><i title="Agregar" class="fa fa-15x fa-plus pull-right"></i></a>
                                              </div>
                                              <div class="form-group" id="Logros">
                                                  <label>RESULTADOS OBTENIDOS COMO PROFESIONAL<span class="obligatorio">*</span></label>
                                                  <input class="form-control mg-bt-10 inp-resultado" id="Resultados" name="Resultados" type="text" placeholder="Ejem: Campeón en natación 100 m libres (2017)"/>
                                                  <a href="javascript:void(0);" class="add" onclick="javascript:agregarInputDinamico(this, 20, 'inp-resultado', 90)"><i title="Agregar" class="fa fa-15x fa-plus pull-right"></i></a>
                                              </div>
                                              <div class="form-group">
                                                  <label>SELECCIONA EL NIVEL DE RENDIMIENTO DE LAS PERSONAS QUE ASESORAS<span class="obligatorio">*</span></label>
                                                  <ul class="checks">
                                                      <li>
                                                          <div class="chk-content">Principiante
                                                              <input name="NivelClientes" value="pr" data-aka="Seleccionar nivel de personas a las que entrenas" type="checkbox" checked="checked"/><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">Intermedio
                                                              <input name="NivelClientes" value="in" type="checkbox"/><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">Avanzado
                                                              <input name="NivelClientes" value="av" type="checkbox"/><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">Profesional
                                                              <input name="NivelClientes" value="pf" type="checkbox"/><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                  </ul>
                                              </div>
                                              <div class="form-group" id="Especialidades">
                                                  <label>ESPECIALIDADES QUE DOMINO<span class="obligatorio">*</span></label>
                                                  <input class="form-control mg-bt-10 inp-esp-domino" id="EspecDomino" name="EspecDomino" type="text" placeholder="Ejem: Entrenamiento uno a uno"/>
                                                  <a href="javascript:void(0);" class="add" onclick="javascript:agregarInputDinamico(this, 20, 'inp-esp-domino', 80)"><i title="Agregar" class="fa fa-15x fa-plus pull-right"></i></a>
                                              </div>
                                              <div class="form-group">
                                                  <label>FORMA DE TRABAJO<span class="obligatorio">*</span></label>
                                                  <ul class="checks">
                                                      <li>
                                                          <div class="chk-content">Al aire libre
                                                              <input type="checkbox" name="FormaTrabajo" value="ai" data-aka="FORMA DE TRABAJO*"><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">Personalizado
                                                              <input type="checkbox" name="FormaTrabajo" value="pe"><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">En grupo
                                                              <input type="checkbox" name="FormaTrabajo" value="eg"><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                      <li>
                                                          <div class="chk-content">Online
                                                              <input type="checkbox" name="FormaTrabajo" value="on"><span class="checkmark"></span>
                                                          </div>
                                                      </li>
                                                  </ul>
                                              </div>
                                          </div>
                                          <div class="form-group" id="FichasDisponibles">
                                              <label>SELECCIONAR FICHA DE INSCRIPCIÓN
                                                  <span class="obligatorio">*</span>
                                                  <i class="fa fa-question-circle" rel="tooltip" data-placement="bottom" title="Puede seleccionar ambas fichas en caso usted trabaje con multiples disciplinas incluído running"></i>
                                              </label>
                                              <div class="row">
                                                  <ul class="checks">
                                                      <div class="col-md-6 col-sm-6 col-xs-6-org">
                                                          <li>
                                                              <img class="img-ficha" th:src="@{/img/form_standard.svg}+'?'+${version}" alt="">
                                                              <div class="chk-content chk-ficha">Standard
                                                                  <input type="checkbox" checked="checked" value="1" name="FichaTrabajo" data-aka="SELECCIONE LA FICHA CON LA QUE VA TRABAJAR" aria-invalid="false"><span class="checkmark info-pago"></span>
                                                              </div>
                                                          </li>
                                                      </div>
                                                      <div class="col-md-6 col-sm-6 col-xs-6-org">
                                                          <li>
                                                              <img class="img-ficha" th:src="@{/img/form_runner.png}+'?'+${version}" alt="">
                                                              <div class="chk-content chk-ficha">Running
                                                                  <input type="checkbox" value="2" name="FichaTrabajo" aria-invalid="false"><span class="checkmark"></span>
                                                              </div>
                                                          </li>
                                                      </div>
                                                  </ul>
                                              </div>
                                          </div>
                                  </div>
                                  <div class="tab-pane fade inpts-2" id="contact">
                                      <div class="form-group">
                                          <label>CORREO ELECTRÓNICO<span class="obligatorio">*</span></label>
                                          <i class="fa fa-check fa-15px i-checked-verified hidden"></i>
                                          <i class="fa fa-spinner fa-spin fa-15px i-checked hidden"></i>
                                          <input class="form-control" type="text" data-aka="CORREO ELECTRÓNICO" id="Correo" name="Correo">
                                      </div>
                                      <div class="form-group">
                                          <label>TELÉFONO</label>
                                          <input class="form-control" type="text" id="Telefono" name="Telefono">
                                      </div>
                                      <div class="form-group">
                                          <label>MÓVIL<span class="obligatorio">*</span></label>
                                          <input class="form-control" type="text" id="Movil" name="Movil">
                                      </div>
                                      <div class="form-group">
                                          <label>TIPO DE DOCUMENTO<span class="obligatorio">*</span></label>
                                          <select class="form-control hidden" id="TipoDocumento" name="TipoDocumento">
                                              <option value="1">DNI</option>
                                              <option value="2">CE</option>
                                          </select>
                                      </div>
                                      <div class="form-group">
                                          <label>DOCUMENTO DE IDENTIDAD<span class="obligatorio">*</span></label>
                                          <input class="form-control" type="text" id="NumeroDocumento" name="NumeroDocumento">
                                      </div>
                                      <div class="form-group">
                                          <label>LUGAR DE RESIDENCIA<span class="obligatorio">*</span></label>
                                          <div class="row">
                                              <div class="col-md-12">
                                                  <div class="col-md-5 col-sm-5">
                                                      <label>DEPARTAMENTO:</label>
                                                  </div>
                                                  <div class="col-md-7 col-sm-7 col-xs-12 pad-0">
                                                      <select class="form-control margin-o-bottom-10 ubigeo hidden" id="Dep" name="Dep" data-aka="Ubigeo departamento" readonly="readonly">
                                                          <option selected="selected" value="15">Lima</option>
                                                      </select>
                                                  </div>
                                              </div>
                                              <div class="col-md-12">
                                                  <div class="col-md-5 col-sm-5">
                                                      <label>PROVINCIA:</label>
                                                  </div>
                                                  <div class="col-md-7 col-sm-7 col-xs-12 pad-0">
                                                      <select class="form-control margin-o-bottom-10 ubigeo hidden" id="Pro" name="Pro" data-aka="Ubigeo provincia">
                                                          <option selected="selected" value="01">Lima</option>
                                                      </select>
                                                  </div>
                                              </div>
                                              <div class="col-md-12">
                                                  <div class="col-md-5 col-sm-5">
                                                      <label>DISTRITO:</label>
                                                  </div>
                                                  <div class="col-md-7 col-sm-7 col-xs-12 pad-0">
                                                      <select class="form-control margin-o-bottom-10 ubigeo hidden" id="Dis" name="Dis" data-aka="Ubigeo distrito">
                                                          <option th:each="z : ${distritos.lstDis} " th:value="${z.cod}" th:text="${z.ubNombre}"></option>
                                                      </select>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="form-group">
                                          <label for="Username">NOMBRE DE USUARIO<span class="obligatorio">*</span></label>
                                          <i class="fa fa-check fa-15px i-checked-verified hidden"></i>
                                          <i class="fa fa-spinner fa-spin fa-15px i-checked hidden"></i>
                                          <input class="form-control" type="text" data-aka="NOMBRE DE USUARIO" id="Username" name="Username">
                                      </div>
                                      <div class="form-group">
                                          <label for="Password">CONTRASEÑA<span class="obligatorio">*</span></label>
                                          <input class="form-control" type="password" id="Password" name="Password">
                                      </div>
                                      <div class="form-group">
                                          <label for="Username">DIRECCIÓN WEB<span class="obligatorio">*</span>
                                              <i class="fa fa-question-circle" rel="tooltip" data-placement="bottom" title="El nombre de página debe empezar con un mínimo de 4 letras(Mínusculas). Los caracteres permitidos son letras(Mínusculas), números y como separadores puede usar puntos y guiones"></i>
                                          </label>
                                          <i class="fa fa-check fa-15px i-checked-verified hidden"></i>
                                          <i class="fa fa-spinner fa-spin fa-15px i-checked hidden"></i>
                                          <input class="form-control" type="text" id="NomPag" name="NomPag" data-aka="DIRECCIÓN WEB">
                                      </div>
                                      <div class="" style="padding-bottom: 10px; font-weight: 100;">
                                          <label id="NomPagFull"></label>
                                      </div>
                                  </div>
                                  <div class="tab-pane fade inpts-3" id="service">
                                      <h1 class="title-form">ELIGE LOS SERVICIOS PARA EL TRAINER</h1>
                                      <form>
                                          <div class="ver-servicios">
                                              <div id="NomServicios" class="form-group">
                                              </div>
                                          </div>
                                          <div class="form-group">
                                              <label>DESCRIPCIÓN</label>
                                              <p id="DescripcionServicio"></p>
                                          </div>
                                          <div class="form-group" id="MainIncluyeServicios">
                                              <label>QUE INCLUYE</label>
                                              <ul id="IncluyeServicio" class="list-counter">
                                                  <li></li>
                                              </ul>
                                          </div>
                                          <div class="form-group hidden">
                                              <label>INFORMACIÓN ADICIONAL</label>
                                              <p id="InfoAdicional"></p>
                                          </div>
                                          <hr>
                                      </form>
                                  </div>
                                  <input type="hidden" id="HshVerEmpTrainerId" th:value="${hshVerEmpTrainerId}">
                                  <input type="hidden" id="HshEmpTrainerId" th:value="${hshEmpTrainerId}">
                              </div>
                          </form>
                          <button class="btn btn-default btn-black" type="button" id="btnGuardar">GUARDAR</button>
                  </div>
              </div>
          </section>
      </div>
      <footer th:replace="html-commons/p/footer :: fg-footer"></footer>
      <!-- MODALS  -->
      <div class="modal fade" tabindex="-1" role="dialog" id="myModalCropper" data-backdrop="static">
          <div class="modal-dialog" role="document" style="width: 70%">
              <div class="modal-content" style="width: 100%">
                  <div class="modal-header" style="background: #000000;text-align: center;border:none">
                      <button id="btnCerrarRecorteFotoPerfil" type="button"  data-dismiss="modal" class="close-modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </div>
                  <div class="modal-body" style="height: 90%;padding: 0px">
                      <div class="col-sm-12 text-center" style="width: 100%;height: 100%;padding:0px;">
                          <img id="ImagePerfil" style="max-width: 90%; max-height: 100%; display:none">
                      </div>
                  </div>
                  <div class="modal-footer" style="background: #000000;text-align: center;border:none">
                      <div class="row" id="actions">
                          <div class="col-md-12 docs-buttons">
                              <div class="btn-group btn-group-crop">
                                  <button style="margin: 20px 20px 10px;border-radius: 5px; min-width: 180px" data-dismiss="modal" type="button" class="btn btn-black" data-method="getCroppedCanvas" data-option="{ &quot;maxWidth&quot;: 4096, &quot;maxHeight&quot;: 4096 }">
                                            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.getCroppedCanvas({ maxWidth: 4096, maxHeight: 4096 })">
                                                <i class="fa fa-check-circle fa-fw"></i>Confirmar
                                            </span>
                                  </button>
                                  <button style="margin: 20px 20px 10px;border-radius: 5px; min-width: 180px" onclick="elegirOtraImagenCropper()" data-dismiss="modal" type="button" class="btn btn-black" data-option="{ &quot;maxWidth&quot;: 4096, &quot;maxHeight&quot;: 4096 }">
                                            <span class="docs-tooltip" data-toggle="tooltip" title="">
                                                <i class="fa fa-refresh fa-fw"></i>Cambiar
                                            </span>
                                  </button>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="col-md-6 no-padding-991" id="status" style="display: none">
          <b>Coordenadas:</b> --
          <br class="cb"/><b>Radio:</b> --
      </div>
    <th:block th:insert="html-commons/p/js :: fg-js"></th:block>
    <script async="" defer="" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPnQe-1f0b5KmTQXUMED0_n9-Vx3Y4ixc&libraries=places&amp;callback=initMap" type="text/javascript"></script>
    <script th:src="@{/js/cropper.min.js}+'?'+${version}" type="text/javascript"></script>
    <script>
        const inpImgPerfil = document.getElementById('InpImgPerfil');
        const imgPerfil = document.getElementById('ImagePerfil');
        const inpMultipleFicha = document.getElementById('InpMultipleFicha');
        const btnGuardar = document.getElementById('btnGuardar');
        const btnVerPerEmpresa = document.getElementById('btnVerPerEmpresa');
        const frm = document.getElementById('frm_registro');
        const verifiedNames = [];
        const initPageActive = 1;
        let servicios = [];
        //Cropper
        let cropper = {};
        const actions = document.getElementById('actions');
        const body = document.querySelector('body');

        (function () {
            uploadAndShow(inpImgPerfil, imgPerfil);

            body.addEventListener('click', bodyClickEventListener);
            body.addEventListener('focusout', bodyFocusOutEventListener);
            body.addEventListener('focusout', bodyFocusOutListenerOwn);
            btnGuardar.addEventListener('click', sendMainForm);
            inpImgPerfil.addEventListener('change', changeImgPerfil);
            inpImgPerfil.addEventListener('click', clickImgPerfiL);
            btnVerPerEmpresa.addEventListener('click', clickRedireccionamientoPerfilEmpresa);
            document.querySelectorAll('a[rel="tooltip"]').forEach(e=>{
                $(e).tooltip();
            })
            init();
        })();

        function instanceInitTab(){
            document.querySelector('.step-0'+initPageActive).classList.toggle('active');
            document.querySelector('.inpts-'+initPageActive).classList.toggle('active');
        }

        function sendMainForm(e){
            e.preventDefault();//To avoid form sended automatically
            const checkList1 = validationByNumSheet(1);
            const checkList2 = validationByNumSheet(2);
            if(checkList1.isValid && checkList2.isValid){
                sendForm();
            }else {
                smallBoxAlertValidation(checkList1.inputs.concat(checkList2.inputs));
            }
        }

        function bodyFocusOutListenerOwn(e) {
            const input = e.target;
            if(input.name === "Correo"){
                if($(input).valid()){
                    if(!verifiedNames.includes(input.value)){
                        validUniqueEmailOrUsernameOrNomPag(input, 'correo');
                    }
                }
            }
            if(input.name === "Username"){
                if($(input).valid()){
                    if(!verifiedNames.includes(input.value)){
                        validUniqueEmailOrUsernameOrNomPag(input, 'username');
                    }
                }
            }
            if(input.name === "NomPag"){
                if($(input).valid()){
                    if(!verifiedNames.includes(input.value)){
                        validUniqueEmailOrUsernameOrNomPag(input, 'nompag');
                    }
                }
            }
        }

        function instanceCropper(){
            actions.querySelector('.docs-buttons').onclick = function (e) {
                let target = e.target;
                let result;
                let data;

                if (!cropper) {
                    return;
                }

                while (target !== this) {
                    if (target.getAttribute('data-method')) {
                        break;
                    }

                    target = target.parentNode;
                }

                if (target === this || target.disabled || target.className.indexOf('disabled') > -1) {
                    return;
                }

                data = {
                    method: target.getAttribute('data-method'),
                    target: target.getAttribute('data-target'),
                    option: target.getAttribute('data-option') || undefined,
                    secondOption: target.getAttribute('data-second-option') || undefined
                };

                if (data.method) {
                    switch (data.method) {
                        case 'getCroppedCanvas':
                            try {
                                data.option = JSON.parse(data.option);
                            } catch (e) {
                                console.log(e.message);
                            }
                            break;
                    }


                    result = cropper[data.method](data.option, data.secondOption);

                    switch (data.method) {
                        case 'getCroppedCanvas':
                            if (result) {
                                $('#FinalImagenRecortada').attr('src', result.toDataURL(inpImgPerfil.files[0].type));
                            }
                            break;
                    }
                }
            }
        }

        function clickMultipleFicha(e){
            const input = e.target;
            if(input.checked){
                btnElegirFicha.textContent = "FICHAS SELECCIONADAS: GENERAL Y RUNNING";
            }else{
                btnElegirFicha.innerHTML = "SELECCIONAR FICHA DE INSCRIPCIÓN<span class=\"obligatorio\">*</span>";
            }
            btnElegirFicha.click();
        }

        function bodyClickEventListener(e){
            const input = e.target;
            const clases = input.classList;
            if(clases.contains('div-fichas')){
                const btn = document.getElementById('btnElegirFicha');
                const fichaName = input.previousElementSibling.textContent.trim();
                btn.innerText = "Ficha seleccionada: "+fichaName;
                btn.click();
                btn.setAttribute("data-ficha-id", fichaName === "Running" ? 1 : 2);
                inpMultipleFicha.checked = false;
            } else if(clases.contains('servicio')){
                const svcFocus = document.querySelector('.svc-focus');
                svcFocus != undefined ? svcFocus.classList.remove('svc-focus') : "";
                clases.add('svc-focus');
                const svcId = Number(input.getAttribute('data-id'));
                mostrarDetalleServicio(svcId);
            } else if(clases.contains('checkmark')){
                const inp = input.previousElementSibling;
                //Importante únicamente para este caso(Sirve para el tab de servicios: elección de servicios)
                if(inp.name==="SvcCheck"){
                    inp.checked = !inp.checked;
                }
            }
            checkBoxAndRadioValidationEventListener(e, input, clases);
        }

        function clickImgPerfiL(e){
            if(typeof cropper.canvas === 'object'){
                e.preventDefault();
                $('#myModalCropper').modal('show');
            }
        }

        function clickRedireccionamientoPerfilEmpresa(){
            const arrUrl = window.location.href.split("/");
            window.location.href = _ctx+"p/trainer/checkout/" + arrUrl[arrUrl.length - 1] + "/"+ arrUrl[arrUrl.length - 2] + "#staff";
        }

        function changeImgPerfil(){
            $('#myModalCropper').modal('show');
        }

        function mostrarDetalleServicio(servicioId){
            const svc = servicios.find(e=>e.id===servicioId);
            document.querySelector('#DescripcionServicio').innerHTML = svc.descripcion.replace(/\r?\n/g, '<br />');
            const infoAdicional = document.getElementById('InfoAdicional');
            infoAdicional.innerHTML = svc.infoAdicional ? svc.infoAdicional.replace(/\r?\n/g, '<br />') : infoAdicional.parentElement.classList.add('hidden');
            if(svc.infoAdicional){
                infoAdicional.parentElement.classList.remove('hidden');
            }
            setIncluyeDelServicio(svc.incluye);
        }

        function setIncluyeDelServicio(incluidos){
            incluidos = incluidos.split("|");
            const mainIncluidos = document.querySelector('#IncluyeServicio');
            mainIncluidos.innerHTML = "";
            incluidos.forEach(e=>{
                mainIncluidos.appendChild(htmlStringToElement(`<li>${e.replace(/\r?\n/g, '\n')}</li>`));
            });
        }

        function uploadFotoPerfil(d){
            //submit the form here
            const hshId = d.res;
            const rdmUUID = d.rdm;
            let file = inpImgPerfil;
            if (file.files.length > 0) {
                file = file.files[0];
                const data = new FormData();

                const blobBin = atob($('#FinalImagenRecortada')[0].src.split(',')[1]);
                var array = [];
                for(var i = 0; i < blobBin.length; i++) {
                    array.push(blobBin.charCodeAt(i));
                }
                var ff=new Blob([new Uint8Array(array)], {type: file.type});
                data.append("file", ff);
                data.append("fileExtension", ".jpg");

                $.ajax({
                    type: 'PUT',
                    url: _ctx+'p/trainer/subir/foto/perfil/'+hshId+'/'+rdmUUID,
                    data : data,
                    contentType: false,
                    processData: false,
                    dataType: 'json',
                    xhr: function() {
                        const myXhr = $.ajaxSettings.xhr();
                        if(myXhr.upload){
                            myXhr.upload.addEventListener('progress', progress, false);
                        }
                        return myXhr;
                    },
                    success: function (data) {
                        /*//Mensaje diferente por flujo particular
                        data.res = "El asesor ha sido registrado correctamente y ya debe aperecer en el perfil principal de la empresa en el tab 'STAFF'. \n\n" +
                            "Puede seguir agregando tantos entrenadores como desee";
                        reqSuccess(data, 3600000);*/
                        $('#btnVerPerEmpresa').click();
                    },
                    error: (xhr)=>{
                        exception(xhr);
                    },
                    complete: ()=> {
                        limpiarMainForm();
                        clearCamposContacto();
                        $(btnGuardar).removeAttr('disabled');
                        $('#FinalImagenRecortada').attr('src', '/img/public/subir_foto.png');
                        setTimeout(() => {
                            $("#frm_registro :input").removeAttr("disabled");
                        }, 1000);
                    }
                });
            }
        }

        function getImgUuids(rdms){
            const all = rdms.split("@");
            let imgPerfil = all[0];
            imgPerfil = imgPerfil.slice(imgPerfil, imgPerfil.lastIndexOf("."));

            let galeria ="";

            if(all.length == 2){
                let imgsGaleria = all[1];
                galeria = imgsGaleria.split("|").filter(v=>v!=="").map(e=>e.slice(0,e.lastIndexOf("."))).join('|');//Solo para este caso se necesita el .filter(v=>!=="")
            }
            let flCondSvcs="";

            if(all.length == 3){
                let imgsGaleria = all[1];
                galeria = imgsGaleria.split("|").map(e=>e.slice(0,e.lastIndexOf("."))).join('|');
                let condSvcs = all[2];
                flCondSvcs = condSvcs.split("|").filter(v=>v!=="").map(e=>e.slice(0,e.lastIndexOf("."))).join('|');
            }
            return imgPerfil + "|" + galeria + "|" + flCondSvcs;
        }

        function init(){
            instanceInitTab();
            mainSeeders();
            getServiciosAsync();
            modalEventos();
            activeTooltips();
            constraintsValidation();
            instanceCropper();
            doMultiselectCheckBox();
            if(flag_form_populate){populateForm();}
        }

        function mainSeeders(){
            getUbigeoPeruLim();
            getIdiomas();
        }

        function activeTooltips(){
            const all = document.querySelectorAll('i[rel="tooltip"]');
            all.forEach(e=>{
                $(e).tooltip();
            })
        }

        function modalEventos(){

            $('#myModalTermCond').on('hidden.bs.modal', ()=> {
                if(!terminosAceptados) {
                    document.getElementById('inpTermCond').checked = false;
                }
            })

            $('#myModalCropper').on('shown.bs.modal', ()=>{
                if(typeof cropper.canvas !== 'object'){
                    const image = document.getElementById('ImagePerfil');
                    cropper = new Cropper(image, {
                        aspectRatio: 1,
                        crop(event) {},
                        zoomOnWheel: false,
                        viewMode: 1,
                        minContainerHeight: image.height > window.innerHeight * 0.8 ? window.innerHeight * 0.8 : image.height
                    });
                }
            })
        }

        function sendForm(){
            const body = generateBody();
            const hshEmpTrainerId = document.getElementById('HshEmpTrainerId').value;

            if(document.getElementById('Coordenadas') != null){
                body.mapCoordenadas = document.getElementById('Coordenadas').textContent.trim();
            }

            if(document.getElementById('RadioCirculo') != null){
                body.mapCircleRadio = document.getElementById('RadioCirculo').textContent.trim();
            }

            body.tipoTrainerId = 3;
            body.svcIds = Array.from(document.querySelectorAll('input[type="checkbox"][name="SvcCheck"]:checked')).map(e=>e.value).join();
            if(body.svcIds === ""){
                $.smallBox({color: "alert", content: '<span><i class="fa fa-exclamation-circle fa-fw"></i>Debe asignar por lo menos un servicio al trainer</span>'});
                return;
            }
            if(!$('#FinalImagenRecortada').attr('src').includes('/img/')){
                $("#frm_registro :input").prop("disabled", true);
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json',
                    url: _ctx + 'p/trainer/empresa/agregar/sub/'+hshEmpTrainerId,
                    dataType: 'json',
                    data: JSON.stringify(body),
                    blockLoading: false,
                    bridgeMultipart: true,
                    success: (d)=> {
                        //Subir imgen
                        uploadFotoPerfil(d, body);
                    }, error: (xhr) => {
                        $("#frm_registro :input").prop("disabled", false);
                        exception(xhr);
                    }, complete: () => {
                        document.querySelectorAll('input[type="checkbox"][name="SvcCheck"]:checked').forEach(e => e.checked = false);
                    }
                })
            }else{
                $.smallBox({color: 'alert',
                            content: "<i>Es obligatorio para el registro agregar una foto de perfil</i>",
                            timeout: 5000});
            }
        }

        function ocultarModalTermCondYAceptar(){
            document.getElementById('inpTermCond').checked=true;
            terminosAceptados = true;
            $('#myModalTermCond').modal('hide');
        }

        function populateForm(){
            //Page 1
            const t0 = String(new Date().getTime());
            const t1 = t0.slice(-3);
            const t2 = t0.slice(-6).slice(0, 3);

            document.querySelector('#Nombres').value = "Pedro ";
            document.querySelector('#Apellidos').value = "Roscate ";
            document.querySelector('input[name="Sexo"]').checked = true;
            document.getElementById('Username').value = "pedro"+t1 + ""+ t2;
            document.getElementById('Password').value = "runfit123";
            Array.from(document.getElementById('Idiomas').querySelectorAll("option"),(e,i)=>i % 2 === 1 ? e.selected = 'selected': '');
            document.getElementById('NomPag').value = "pedro"+t1 + ""+ t2;
            document.querySelector('#Especialidad').value = `Entrenador para maratones`;
            document.querySelector('#Acerca').value = 'Soy licenciado en cultura física y ex campeón nacional de natación.\n\n Me dedico a entrenar a profesionales y amateurs de natación desde hace más de 10 años, logrando que muchos de mis alumnos lleguen a ganar campeonatos nacionales, sudamericanos y cualquier otro logro personal. Considero que la natación es una disciplina completa y sobre todo una pasión que tiene muchos beneficios en la vida diaria. No solo es cuestión de talento sino del esfuerzo y compromiso que uno le ponga a la disciplina. \n\nConmigo el trabajo será duro pero valdrá la pena.';
            document.querySelector('#Disciplinas').value = "Running";

            populateTabContacto(t0, t1, t2);
            //Estudios
            const inpEst = document.querySelector('.inp-estudio');
            const a = inpEst.nextElementSibling;
            ["Licenciado en cultura física y deporte",
            "Diplomado en nutrición para atletas",
            "Diplomado en rehabilitación enfocada en deportista calificados",
            "Curso en rescate en el agua",
            "Curso en metodología del entrenamiento"].forEach(e => agregarInputDinamico(a, 20, 'inp-estudio', 90).value = e);
            document.querySelector('#EstudiosCertificaciones').value = "Diplomado en nutrición para atletas";
            document.querySelector('#MetodoTrabajo').value = 'Está centrado en buscar un equilibrio armónico entre las leyes de la física, la fisiología y la biomecánica humana, logrando como resultado un eficiente desplazamiento con bajo impacto articular y poco coste energético. El sistema es complementado con el mejoramiento de las capacidades motrices, para obtener mejores resultados.\n' +
                '\n' +
                'Desarrollamos una metodología pedagógica altamente efectiva, con sistemas de clases didácticas y experienciales, que han ayudado a cientos de personas a mejorar su rendimiento. Ellas han aprendido a correr de forma distinta, con sensaciones positivas y disfrutando del running como nunca antes.';
            //Experiencia Laboral
            const inpExp = document.querySelector('.inp-experiencia');
            const ab = inpExp.nextElementSibling;
            ["Entrenador en AquaLab (2013 – hasta la fecha)",
             "Entrenador freelance (2005 – hasta la fecha)",
             "Selección nacional de natación (2000 – 2005)"].forEach(e => agregarInputDinamico(ab, 20, 'inp-experiencia', 90).value = e);
            document.querySelector('#Experiencias').value = "Diplomado en nutrición para atletas";
            //Resultados
            const inpRes = document.querySelector('.inp-resultado');
            const abc = inpRes.nextElementSibling;

            ["Juan Pérez, campeón en natación 100 m libres (2017)",
                "Rocío Flores, campeona sudamericana 4x100 m (2017)",
                "Michael Barros, campeón en natación 4x200 (2016)",
                "Entrenador del año (2015)"].forEach(e => agregarInputDinamico(abc, 20, 'inp-resultado', 90).value = e);
            document.querySelector('#Resultados').value = "Diplomado en nutrición para atletas";
            //Especialidades que domino
            const inpEspDom = document.querySelector('.inp-esp-domino');
            const abcd = inpEspDom.nextElementSibling;
            ["Entrenamiento en grupo",
                "Entrenamiento uno a uno",
                "Natación para profesionales"].forEach(e => agregarInputDinamico(abcd, 4, 'inp-esp-domino', 80).value = e);
            document.querySelector('#EspecDomino').value = "Diplomado en nutrición para atletas";

            document.querySelector('#Telefono').value = `017776666`;
            document.querySelector('#NumeroDocumento').value = `23232323`;

            document.querySelector('input[name="FormaTrabajo"]').checked = true;

            setTimeout(()=>{
                document.querySelector('input[name="SvcCheck"]').checked = true;
            }, 1000)
        }

        function populateTabContacto(t, t1, t2){
            document.querySelector('#Correo').value = "d"+t+t1+t2+"@gmail.com";
            document.querySelector('#Movil').value = t;
        }

        function generateBody(){
            const obj = getFormData($('#frm_registro'));
            obj.sexo = Number($('input[name="Sexo"]:checked').val());

            //Ubigeo
            obj.paisId = 604;
            obj.ubigeo = $('#Dep').val() + $('#Pro').val() + $('#Dis').val();
            obj.telefono = document.getElementById('Telefono').value;
            obj.movil = document.getElementById('Movil').value;
            obj.tipoDocumentoId = document.getElementById('TipoDocumento').value;
            obj.documento = document.getElementById('NumeroDocumento').value;
            obj.correo = document.getElementById('Correo').value;
            obj.username = document.getElementById('Username').value;
            obj.password = document.getElementById('Password').value;
            obj.disciplinas = getValuesByClass('inp-disciplina');
            obj.idiomas = $('#Idiomas').val().join('|');
            obj.niveles = getValuesConcatInpCheckbox('NivelClientes');
            obj.especialidades = getValuesByClass('inp-esp-domino');
            obj.estudios = getValuesByClass('inp-estudio');
            obj.experiencias = getValuesByClass('inp-experiencia');
            obj.resultados = getValuesByClass('inp-resultado');
            obj.formasTrabajo = getValuesConcatInpCheckbox('FormaTrabajo');
            obj.fichaClienteIds = getValuesConcatInpCheckbox('FichaTrabajo');
            obj.nomPag = document.getElementById('NomPag').value;

            if(!obj.horario){
                delete obj.horario;
            }

            if(!obj.centroTrabajo){
                delete obj.centroTrabajo;
            }

            if(!obj.telefono){
                delete obj.telefono;
            }
            return obj;
        }

        function elegirOtraImagenCropper(){
            cropper.destroy();
            cropper = {};
            inpImgPerfil.click();
        }

        function clearCamposContacto(){
            document.querySelector('#Correo').value = "";
            document.querySelector('#Telefono').value = "";
            document.querySelector('#Movil').value = "";
            document.querySelector('#TipoDocumento').selectedIndex = 0;
            document.querySelector('#Dis').selectedIndex = 0;
            document.querySelector('#Username').value = "";
            document.querySelector('#Password').value = "";
        }

        function getServiciosAsync(){
            const arrUrl = window.location.href.split("/");
            const hshEmpTraId = arrUrl[arrUrl.length - 2];
            const mainEndpoint = _ctx+'p/trainer/get/servicios/hsh/'+ hshEmpTraId + '?tipoTrainerId='+TipoTrainer.EMPRESA;

            $.ajax({
                type: 'GET',
                url: mainEndpoint,
                dataType: 'json',
                noOne: true,
                success: function (res) {
                    servicios = res;
                    reconstruirServicios(servicios);
                }, error: (xhr) => {
                    if (xhr.status == 404) {
                        window.location.href = _ctx + "p/recurso-no-encontrado";
                    }
                    exception(xhr);
                }, complete: () => {
                }
            })
        }

        function reconstruirServicios(servicios){
            const dvServicios = document.getElementById('NomServicios');
            dvServicios.innerHTML = servicios.map((e, ix) => `
                        <div>
                            <div class="chk-content" style="float:right">
                              <input name="SvcCheck" value="${e.id}" type="checkbox"><span class="checkmark"></span>
                            </div>
                            <label class="servicio ${ix===0 ? 'svc-focus':''}" data-id="${e.id}">${e.nombre}</label>
                        </div>`).join('');
            const fSs = servicios[0];
            document.getElementById('DescripcionServicio').innerHTML =  fSs.descripcion.replace(/\r?\n/g, '<br />');
            const dvIncServicio = document.getElementById('IncluyeServicio');
            dvIncServicio.innerHTML = fSs.incluye.split("|").map((e) => `<li>${e}</li>`).join('');
            if(servicios[0].infoAdicional){
                document.getElementById('InfoAdicional').innerHTML = servicios[0].infoAdicional.replace(/\r?\n/g, '<br />');
            }
            selServicioId = fSs.id;
        }

        function constraintsValidation() {
            $(frm).validate({
                errorClass: errorClass,
                errorElement: errorElement,
                highlight: function (element) {
                    if(element.type === 'radio' || element.type==='checkbox'){
                        let msgError = "";
                        setTimeout(() => {
                            const eleMsgError = document.querySelector(`#${element.name}-error`);
                            if(eleMsgError != undefined){
                                msgError = eleMsgError.textContent;
                                eleMsgError.remove();
                            }
                        }, 100);
                        const parentRadios = element.parentElement.parentElement.parentElement.parentElement;
                        setTimeout(() => {parentRadios.querySelector('em') != undefined ? parentRadios.querySelector('em').textContent = msgError : parentRadios.append(htmlStringToElement(`<em style="color: #E54C4B;">${msgError}</em>`))}, 200);
                    }else{
                        $(element).removeClass('state-success').addClass("state-error");
                        $(element).removeClass('valid');
                    }
                },
                unhighlight: function (element) {
                    if(element.type === 'radio' || element.type==='checkbox'){
                        const parentRadios = element.parentElement.parentElement.parentElement.parentElement;
                        parentRadios.querySelector('em') != undefined ? parentRadios.querySelector('em').remove() : '';
                    } else {
                        $(element).removeClass("state-error").addClass('state-success');
                        $(element).addClass('valid');
                    }
                },
                ignore: ".ignore",
                rules: {
                    Nombres: {
                        required: true,
                        rangelength: [3, 30],
                        lettersonly: true

                    },
                    Apellidos: {
                        required: true,
                        rangelength: [3, 30],
                        lettersonly: true
                    },
                    Sexo:{
                        required: true
                    },
                    Especialidad:{
                        required: true,
                        rangelength: [5, 80]
                    },
                    DisciplinaId:{
                        required: true
                    },
                    Acerca:{
                        required: true,
                        rangelength: [80, 2000]
                    },
                    Idiomas:{
                        required: true
                    },
                    EstudiosCertificaciones:{
                        required: true,
                        rangelength: [8, 90]
                    },
                    MetodoTrabajo:{
                        required: true,
                        rangelength: [5, 1000]
                    },
                    Experiencias: {
                        required: true,
                        rangelength: [20, 90]
                    },
                    Resultados: {
                        required: true,
                        rangelength: [20, 90]
                    },
                    Disciplinas:{
                        required: true,
                        rangelength: [3, 80]
                    },
                    NivelClientes:{
                        required: true
                    },
                    EspecDomino: {
                        required: true,
                        rangelength: [10, 80]
                    },
                    FormaTrabajo:{
                        required: true
                    },
                    Correo: {
                        required: true,
                        emailAddress: true,
                        rangelength: [7, 40]
                    },
                    Telefono:{
                        digits: true,
                        rangelength: [7, 11]
                    },
                    Movil:{
                        required: true,
                        digits: true,
                        rangelength: [7, 13]
                    },
                    NumeroDocumento: {
                        required: true,
                        digits: true,
                        rangelength: [8, 13],
                        customnumdoc: function(){
                            const val = $('#TipoDocumento').val();
                            return val;
                        }
                    },
                    Username:{
                        required: true,
                        pattern: "[a-z]{3,}[0-9]*$",
                        rangelength: [7, 30],
                    },
                    Password:{
                        required: true,
                        rangelength: [8, 30],
                        pwcheck: true
                    },NomPag: {
                        required: true,
                        pattern:"[a-z]{4,}[0-9\\w.\\w-]*$",
                        rangelength: [4, 40]
                    }
                },
                messages: {
                    Username: {
                        pattern: "Solo se admiten letras mínusculas y números, además el nombre debe empezar con 3 letras"
                    },
                    PrecioPaquete:{
                        number: function(){
                            setTimeout(() => {
                                $('#IcoPrecioPaquete').tooltip();
                            }, 200);
                            return '<i class="fa fa-fw fa-exclamation-circle" id="IcoPrecioPaquete" title="Solo se permiten números con punto como separador decimal"></i>';
                        },
                        min: function(){
                            setTimeout(() => {
                                $('#IcoPrecioPaquete').tooltip();
                            }, 200);
                            return '<i class="fa fa-fw fa-exclamation-circle" id="IcoPrecioPaquete" title="El valor debe ser mayor a 0"></i>';
                        },
                    },
                    txtCantidadPersonas:{
                        min: function(){
                            setTimeout(() => {
                                $('#IcoTxtCantidadPersonas').tooltip();
                            }, 200);
                            return '<i class="fa fa-fw fa-exclamation-circle" id="IcoTxtCantidadPersonas" title="Debe especificar un valor mayor a 0" style="color: #c46a69"></i>';
                        }
                    },
                    txtCantidadMeses:{
                        min: function(){
                            setTimeout(() => {
                                $('#IcoTxtCantidadMeses').tooltip();
                            }, 200);
                            return '<i class="fa fa-fw fa-exclamation-circle" id="IcoTxtCantidadMeses" title="Debe especificar un valor mayor a 0" style="color: #c46a69"></i>';
                        }
                    },
                    txtCantidadSesiones:{
                        min: function(){
                            setTimeout(() => {
                                $('#IcoTxtCantidadSesiones').tooltip();
                            }, 200);
                            return '<i class="fa fa-fw fa-exclamation-circle" id="IcoTxtCantidadSesiones" title="Debe especificar un valor mayor a 0" style="color: #c46a69"></i>';
                        }
                    },
                    NumeroCuentaSoles:{
                        pattern: "Solo se permiten números y como separadores espacio y guión",
                    },
                    InterbancarioSoles:{
                        pattern: "Solo se permiten números y como separadores espacio y guión",
                    },
                }
            });

            const rules = $(frm).validate().settings.rules;
            Object.keys(rules).filter(e=>rules[e].hasOwnProperty('rangelength')).forEach(e=>{
                document.getElementById(e).setAttribute('maxlength', rules[e].rangelength[1]);
            });
        }

    </script>
  </body>
</html>
