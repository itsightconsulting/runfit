<!DOCTYPE html>
<html lang="en-us" style="background-color: #fff;"
      xmlns:th="http://www.thymeleaf.org"
      th:with="version = ${#servletContext.getAttribute('version')}">
<head>
    <title>Gestión - Planes prediseñados</title>
    <th:block th:insert="html-commons/tr/meta :: fg-meta"></th:block>
    <th:block th:insert="html-commons/tr/css  :: fg-css"></th:block>
</head>
<style>
    .btn-circle {
        float: right!important;
        border-radius: 50%;
        font-size: 20px;
        background-color: #bcbcbc;
        color: #fff;
        top: -70px;
        position: relative;
        right: 220px;
    }
    .btn-dark{
        color:#ffffff!important;
        background-color: #000000;
    }
    .title-categoria
    {
        word-wrap: break-word;
        width: 200px;
        /* text-align: center; */
        margin: auto;
        /* height: 100px; */
        font-family: GothamHTF-Book;
        color: #daffc6;
        font-size: 28px;
        line-height: 1;
        font-weight: 600;
    }
    .title-categoria.sm
    {
        font-size: 16.5px;
        line-height: 1.2;
    }
    .title-categoria.md
    {
        font-size: 28px;
    }
    .title-categoria.lg
    {
        font-size: 48px;
    }
    .owl-dots {
        max-width: 45%;
    }
</style>
<body style="background-color: #fff;">
<div id="wrapper">

    <div class="modal fade" id="modalNuevaCategoria" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <section id="nuevaCategoriaPlantilla">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:black">
                        <strong>NUEVA CATEGORÍA</strong>  <i class="i-btn fa fa-close fa-15x mdl-dark-header pull-right" data-dismiss="modal"></i>
                    </div>

                    <div class="modal-body">
                        <div class="container-fluid padding-0 text-align-center" id="nuevaCategoria">
                            <form id="nueva_categoria_frm"  method="post">

                                <div class="form-group form-alt">
                                    <label>NOMBRE </label>
                                    <input id="nombreCategoria" name="nombreCategoria" type="text" class="form-control">
                                </div>
                                <div class="form-group form-alt">
                                    <label> TIPO DE RUTINA </label>
                                   <div class="text-center">
                                    <ul class="checks text-center">
                                        <li>
                                            <label class="chk-content">PLANTILLA ESTÁNDAR
                                                <input type="checkbox" name="cbNuevaCategoria" value="2"><span class="checkmark"></span>
                                            </label>
                                        </li>
                                        <li>
                                            <label class="chk-content">PLANTILLA RUNNING
                                                <input type="checkbox" name="cbNuevaCategoria" value="1"><span class="checkmark"></span>
                                            </label>
                                        </li>
                                    </ul>
                                   </div>


                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-md btn-darkgrey" onclick="agregarCategoria()">AGREGAR CATEGORIA</button>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <div class="modal fade" id="modalEditarCategoria" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <section id="editarCategoriaPlantilla">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:black">
                        <strong>EDITAR CATEGORÍA</strong>  <i class="i-btn fa fa-close fa-15x mdl-dark-header pull-right" data-dismiss="modal"></i>
                    </div>

                    <div class="modal-body">
                        <div class="container-fluid padding-0 text-align-center" id="editarCategoria">
                            <form id="editar_categoria_frm"  method="post">

                                <div class="form-group form-alt">
                                    <label>NOMBRE </label>
                                    <input id="nombreCategoriaEdit" name="nombreCategoriaEdit" class="form-control" type="text">
                                </div>
                                <div class="form-group form-alt">
                                    <label> TIPO DE RUTINA </label>
                                  <div class="text-center">
                                    <ul class="checks text-center">
                                        <li>
                                            <label class="chk-content">PLANTILLA ESTÁNDAR
                                                <input type="checkbox" name="cbEditarCategoria" value="2"><span class="checkmark"></span>
                                            </label>
                                        </li>
                                        <li>
                                            <label class="chk-content">PLANTILLA RUNNING
                                                <input type="checkbox" name="cbEditarCategoria" value="1"><span class="checkmark"></span>
                                            </label>
                                        </li>
                                    </ul>
                                  </div>

                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-md btn-dark" onclick="eliminarCategoria()" id="btnEliminarCategoria">ELIMINAR CATEGORIA </button>
                        <button class="btn btn-md btn-darkgrey"  id="btnEditarCategoria" onclick="actualizarCategoriaPlantilla()">GUARDAR CAMBIOS</button>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <div class="modal fade" id="modalNuevaRutina" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <section id="nuevaRutinaPlantilla">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:black">
                        <strong>NUEVA RUTINA PREDISEÑADA</strong>  <i class="i-btn fa fa-close fa-15x mdl-dark-header pull-right" data-dismiss="modal"></i>
                    </div>

                    <div class="modal-body">
                        <div class="container-fluid padding-0 text-align-center" id="nuevaRutina">
                            <form id="nueva_rutina_pred_frm"  method="post">

                                <div class="form-group form-alt">
                                    <label> NOMBRE </label>
                                    <input id="nombreRutina" class="form-control" name="nombreRutina" type="text">
                                </div>

                                <div class="form-group form-alt">
                                    <label> SEMANAS </label>
                                    <input id="semanasRutina" class="form-control" name="semanasRutina" type="number">
                                </div>



                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-md" onclick="agregarRutina()">AGREGAR RUTINA PREDISEÑADA</button>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <div class="modal fade" id="modalEditarRutina" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <section id="editarRutinaPlantilla">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:black">
                        <strong>EDITAR RUTINA PREDISEÑADA</strong>  <i class="i-btn fa fa-close fa-15x mdl-dark-header pull-right" data-dismiss="modal"></i>
                    </div>

                    <div class="modal-body">
                        <div class="container-fluid padding-0 text-align-center" id="editarRutina">
                            <form id="editar_rutina_pred_frm"  method="post">

                                <div class="form-group form-alt">
                                    <label> NOMBRE </label>
                                    <input id="nombreRutinaEdit" class="form-control" name="nombreRutinaEdit" type="text">
                                </div>


                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-md" onclick="actualizarRutina()" id="btnEditarRutina">EDITAR RUTINA PREDISEÑADA</button>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <header>
        <ul class="nav nav-pills">
            <li class="icons"><a href="#"><img class="svg" th:src="@{/img/iconos-trainers/icon_guardar.svg}"></a><a href="#"><img class="svg" th:src="@{/img/iconos-trainers/icon_abc.svg}"></a><a href="#"><img class="svg" th:src="@{/img/iconos-trainers/icon_arrow-left.svg}"></a><a href="#"><img class="svg" th:src="@{/img/iconos-trainers/icon_arrow-right.svg}"></a></li>
            <li class="active"><a href="#">listado</a></li>
            <li><a href="#">g. videos</a></li>
            <li><a href="#">rutinario</a></li>
            <li><a href="#">g. audios</a></li>
            <li><a href="#">planes prediseñados</a></li>
        </ul>
    </header>

    <section id="listaCategoria">
        <div class="container-t">
            <a th:href="@{/bienvenido}" class="logo-link">
               <img class="logoBlack"  th:src="@{/img/logo_black.png}">
            </a>
            <h2 class="title_carousel dots">planes<span>- pre diseñados</span></h2>

            <a data-toggle="modal" data-target="#modalNuevaCategoria" type="button" class="btn btn-circle btn-lg"  title="Registrar">
                <div>
                    <i class="fa fa-plus fa-2x"></i>
                </div>

            </a>

            <ul class="checks text-center">
                <li>
                    <label class="chk-content">PLANTILLA ESTÁNDAR
                        <input type="checkbox" class="radio" name="cbSeleccionTipo" value="2"><span class="checkmark"></span>
                    </label>
                </li>
                <li>
                    <label class="chk-content">PLANTILLA RUNNING
                        <input type="checkbox" class="radio" name="cbSeleccionTipo" value="1"><span class="checkmark"></span>
                    </label>
                </li>
            </ul>
            <div class="owl-carousel owl-theme" id="planesCarousel">
            </div>

        </div>
    </section>

    <div class="shadow-gris">
        <div class="container-t">
            <div class="slider-container">
                <input class="range-slider" type="range" id="range" value="0" name="range" min="0" step="1" max="5">
            </div>
        </div>
    </div>

    <section id="info">
        <div class="container-t">
            <div class="text-center">
                <div class="form-group pull-left">
                    <div class="search">
                        <div class="input-group">
                            <input class="form-control" type="text" id="inpSearch">
                        </div>
                    </div>
                </div><a class="scroll" href="#"><img class="svg" th:src="@{/img/iconos-trainers/icon_arrow-top.svg}"></a>
                <div class="form-group pull-right">
                    <select class="form-control">
                        <option>1 - plan de 1 semanas</option>
                    </select>

                    <a data-toggle="modal" data-target="#modalNuevaRutina" type="button" href="#" class="btn btn-circle btn-lg" id="btnNuevaRutina" title="Nueva Rutina">
                        <i class="fa fa-plus fa-2x"></i>
                    </a>

                </div>
            </div>
            <div class="clearfix"></div>
            <h1 class="title_big">15<span>km - </span><i>intermedios</i></h1>
            <ul class="list-plan">
            </ul>
            <div class="clearfix"></div>
        </div>
    </section>

</div>


<th:block th:insert="html-commons/tr/js :: fg-js"></th:block>
<!-- OTRAS LIBRERIAS DISTINTAS AL TEMPLATE -->

<script th:inline="javascript">
    const body = document.getElementsByTagName("body")[0];
    const owl = $('.owl-carousel');
    const cbox = $('input[type="radio"][name="cbNuevaCategoria"]');
    const dvListaCategoria = document.querySelector("section#listaCategoria div");
    const dvListaRutinas = document.querySelector("section#info div");
    const mdlEditarCat = document.getElementById("modalEditarCategoria");
    const mdlEditarRutina = document.getElementById("modalEditarRutina");
    const mdlAgregarCat = document.getElementById("modalNuevaCategoria");
    const btnEditarCat = document.getElementById("btnEditarCategoria");
    const btnEliminarCat = document.getElementById("btnEliminarCategoria");
    const mdlAgregarRutina = document.getElementById("modalNuevaRutina");
    const btnEditarRutina = document.getElementById("btnEditarRutina");
    const btnNuevaRutina = document.getElementById("btnNuevaRutina");
    const ulListRutina = $('.list-plan');
    const anchorItemBody = $('.item-body a');
    const inpSearchRutina = document.getElementById('inpSearch');
    let currentRutinasData;
    const favoritos = [];
    let dataCategorias;
    $(function(){
        onInit();
    })
    function onInit(){
        checkBoxTipoChangeEvent();
        checkBoxasRadioButtons();
        obtenerCategorias();
        owl.on('click', '.item-header', categoriaClickListenerEvent);
        ulListRutina.on('click', 'li', rutinaClickListenerEvent);
        inpSearchRutina.addEventListener('input', searchRutinaEvent);
        owl.on('click', '.item-body a', seleccionCategoriaEvent);
        body.addEventListener('focusout', bodyFocusOutEventListener);
        constraintsValidation();
        scrollEvent();
    }
    function seleccionCategoriaEvent(e){
        //  debugger
        const input = e.currentTarget;
        let categoriaId;
        let catNombre;
        inpSearchRutina.value = '';
        categoriaId = input.getAttribute('data-categoria-id');
        catNombre = input.getAttribute('data-nombre');
        $('section#info .title_big').text(catNombre);
        btnNuevaRutina.setAttribute('data-categoria-id' , categoriaId);
        obtenerRutinas(categoriaId);
        $("section#info").slideDown(200);
        $( 'html, body' ).stop().animate({
            scrollTop: $("section#info").offset().top
        });
        return false;
    }

    function bodyFocusOutEventListener(e){
        const input = e.target;
        if(input.tagName === "INPUT"){
            if(input.type==="text"){
                input.value = input.value.trim();
            }
        }
        if(input.tagName === "TEXTAREA"){
            input.value = input.value.trim();
        }
    }


    function scrollEvent(){
        $(".scroll").click(function() {
            ocultarSeccionRutinas();
            return false;
        });
    }
    function ocultarSeccionRutinas(){
        $("section#info").slideUp(200);
        $('html, body').animate({
            scrollTop: 0
        }, 800);
    }
    function agregarCategoria() {
        if ($('#nueva_categoria_frm').valid()) {
            const nombre = $('#nombreCategoria').val()
            const tipoRutina = $('input[type="checkbox"][name="cbNuevaCategoria"]:checked').val();

            $.ajax({
                type: 'POST',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                url: _ctx + 'gestion/categoria-plantilla/agregar',
                blockLoading: false,
                noOne: true,
                data: {
                    nombre: nombre,
                    tipo: tipoRutina,
                    favorito : false
                },
                dataType: 'json',
                success: (data) => {
                    $(mdlAgregarCat).modal('hide');
                    $('#nueva_categoria_frm')[0].reset();
                    obtenerCategorias();
                    $('input[name="cbSeleccionTipo"]').prop('checked', false);
                },
                error: (xhr) => {
                       const mensaje = xhr.responseJSON.message;

                       $.smallBox({
                             title: "RUNFIT",
                             content: '<p>'+mensaje+'</p>',
                             timeout: 4500,
                             color:  '#cc4d4d',
                             icon: "fa fa-exclamation-circle"
                         })

                },
                complete: (d) => {

                }
            })
        }
    }
    function obtenerCategorias(){
        //     const nombre = $('#nombreCategoria').val()
        //     const tipoRutina = $('input[type="checkbox"][name="cbSeleccionTipo"]:checked').val();
        $.ajax({
            type: 'GET',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            url: _ctx+'gestion/categoria-plantilla/obtener',
            dataType: 'json',
            blockLoading: false,
            noOne: true,
            success: (data) =>  {
                dataCategorias = data;
                if(dataCategorias.length <= 5){
                    const dvSlider = document.querySelector('.range-slider').parentElement;
                    const clasesSlider = dvSlider.classList;
                    if(!clasesSlider.contains('hidden')){
                        clasesSlider.add('hidden');
                    }
                }


                obtenerCategoriasPlantillas(dataCategorias);
            } ,
            error: (d) =>{
            },
            complete: (d) =>{
            }
        })
    }
    function actualizarCategoriaPlantilla() {
        if ($('#editar_categoria_frm').valid()) {
            const nombre = $('#nombreCategoriaEdit').val()
            const tipoRutina = $('input[type="checkbox"][name="cbEditarCategoria"]:checked').val();
            const categoriaId = Number(btnEditarCat.getAttribute("data-categoria-id"));
            $.ajax({
                type: 'PUT',
                url: _ctx + "gestion/categoria-plantilla/actualizar",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                blockLoading: false,
                noOne: true,
                data: {id: categoriaId, nombre: nombre, tipo: tipoRutina},
                dataType: 'json',
                success: (d) => {
                    console.log(d);
                },
                error: (e) => {
                },
                complete: (c) => {
                    obtenerCategorias();
                    $(mdlEditarCat).modal('hide');
                }
            })
        }
    }
    function obtenerCategoriasPlantillas(data){
        if(data.length > 0) {
            data = data.sort(function (a, b) {
                if (a.favorito > b.favorito) return -1;
                if (a.favorito < b.favorito) return 1;
                if (a.id < b.id) return -1;
                if (a.id > b.id) return 1;
                return 0;
            });
            let itemsCategoria = "";

            data.length <= 6 ? 1 :  document.querySelector('.range-slider').max =  data.length - 5;

            data.forEach(function(element) {
                let claseCategoria = "title-categoria";
                let tamanio = element.nombre.length <= 4 && 1 <= (element.nombre).split("").length <= 2  ? "lg" :
                    (element.nombre.length < 18 && 1 <= (element.nombre).split("").length <= 3  ?  "md" : "sm");
                claseCategoria += " "+ tamanio;
                if(element.favorito){
                    favoritos.push(element.id);
                    itemsCategoria += `
              <div class="item" >
                <div class="item-header"><a class="star selected" data-categoria-id = "${element.id}"><img class="svg" src="/img/iconos-trainers/icon_star.svg"></a><a data-toggle="modal" class="icon-edit" data-target="#modalEditarCategoria" type="button" href="#"  data-categoria-id ="${element.id}"  data-nombre="${element.nombre}" data-tipo ="${element.tipo}"><img class="svg" src="/img/iconos-trainers/icon_edit.svg"  ></a><div class="${claseCategoria}"> <p> ${element.nombre} </> </div> </div>
                <div class="item-body"><img class="svg" src="/img/iconos-trainers/icon_tablero.svg"><a data-categoria-id ="${element.id}"  data-nombre="${element.nombre}"><img class="svg" src="/img/iconos-trainers/icon_add.svg">Agregar</a></div>
              </div>
              `;
                }else{
                    itemsCategoria += `
             <div class="item" >
                <div class="item-header"><a class="star" data-categoria-id = "${element.id}"><img class="svg" src="/img/iconos-trainers/icon_star.svg"></a><a data-toggle="modal" class="icon-edit" data-target="#modalEditarCategoria" type="button" href="#" data-categoria-id ="${element.id}"  data-nombre="${element.nombre}" data-tipo ="${element.tipo}"><img class="svg" src="/img/iconos-trainers/icon_edit.svg" ></a><div class="${claseCategoria}"> <p> ${element.nombre} </p> </div> </div>
                <div class="item-body"><img class="svg" src="/img/iconos-trainers/icon_tablero.svg"><a data-categoria-id ="${element.id}"  data-nombre="${element.nombre}"><img class="svg" src="/img/iconos-trainers/icon_add.svg">Agregar</a></div>
             </div>
           `;
                }
            });
            $('.owl-carousel').trigger('replace.owl.carousel', itemsCategoria).trigger('refresh.owl.carousel');
            $('.owl-stage').css('display','inline-flex');
            $('.owl-item').css('width','229.8px');
            $('.owl-item').css('margin-right','10px');
            imgtoSvgEvent();
            visualizarElementosOcultos();
        }else{
            let mensajeNoData;
            if(dataCategorias.length === 0){
                mensajeNoData = htmlStringToElement(`
                    <p class="mensaje-no-data"> No cuenta con alguna categoría de plantillas de rutinas. Dele click al botón de Agregar para
                       iniciar su colección </p>
            `) ;
                dvListaCategoria.appendChild(mensajeNoData);
                ocultarElementos(1);
            }else{
                let mensajeNoData = htmlStringToElement(`
                    <p class="mensaje-no-data"> No cuenta con registros para el tipo de categoría consultado. Dele click al botón de Agregar para
                       iniciar su colección </p>
            `) ;
                dvListaCategoria.appendChild(mensajeNoData);
                ocultarElementos(2);
            }
            owl.css('display' , 'show');
        }
        ocultarSeccionRutinas();
    }
    function eliminarCategoria(){

        const obj ={id :  Number(btnEliminarCat.getAttribute('data-categoria-id'))};
        const nombre = btnEliminarCat.getAttribute('data-nombre');

        $.SmartMessageBox({
            title: "<i class='fa fa-2x fa-trash' style='display:flex; align-items: center; margin-right:0.7em;'></i> ¿Está seguro que desea eliminar la categoría "+ nombre + " ( Se eliminarán todas las rutinas asociadas a esta )?",
            buttons: "[No][Si]"
        }, function(e) {
            "Si" == e &&
            $.ajax({
                url: _ctx + "gestion/categoria-plantilla/eliminar",
                type: "DELETE",
                dataType: 'json',
                blockLoading: false,
                noOne: true,
                data: obj,
                success: function(e) {
                    $(mdlEditarCat).modal('hide');
                    obtenerCategorias();
                },
                error: function(e) {
                    console.log(e)
                }
            })
        })
        $('.MsgTitle').css('display','flex');
    }
    function visualizarElementosOcultos(){
        $('.slider-container').css('display' , 'block');
        $('section#listaCategoria .checks').css('display' , 'block');
        $('.mensaje-no-data').remove();
    }
    function ocultarElementos(tipo){
        const item = document.querySelectorAll('body .item')
        switch(tipo) {
            case 1 :
                $('section#listaCategoria .checks').css('display' , 'none');
                $('.slider-container').css('display' , 'none');
                break;
            case 2 :
                debugger
                $('.slider-container').css('display' , 'none');
                for (let i=0; i<item.length; i++) {
                    owl.trigger('remove.owl.carousel', [i])
                        .trigger('refresh.owl.carousel');
                }
                break;
            default:
                null;
        }
    }
    function actualizarFavoritoCategoria(categoriaId) {
        $.ajax({
            type: 'PUT',
            url: _ctx + "gestion/categoria-plantilla/actualizar-favorito",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: {id: categoriaId},
            dataType: 'json',
            success: (d) => {
            },
            error: (e) => {
            },
            complete: (c) => {
                //     obtenerCategorias();
                //     $(mdlEditarCat).modal('hide');
            }
        })
    }
    function checkBoxasRadioButtons(){
        $("input:checkbox").on('click', function() {
            let $box = $(this);
            if ($box.is(":checked")) {
                let group = "input:checkbox[name='" + $box.attr("name") + "']";
                $(group).prop("checked", false);
                $box.prop("checked", true);
            } else {
                $box.prop("checked", false);
            }
        });
    }
    function checkBoxTipoChangeEvent() {
        $("section#listaCategoria input:checkbox").on('change', function () {
            let cbSeleccionado = $(this)[0].value;
            if($("input:checkbox[name='cbSeleccionTipo']:checked").length === 0){
                obtenerCategoriasPlantillas(dataCategorias);
            }else {
                console.log(dataCategorias);
                if (dataCategorias.length > 0) {
                    let dataCategoriasTipo = dataCategorias.filter((e) => e.tipo === Number(cbSeleccionado));
                    obtenerCategoriasPlantillas(dataCategoriasTipo);
                }
            }
            inpSearchRutina.value = '';
            ocultarSeccionRutinas();
        })
    }
    function categoriaClickListenerEvent(e){
        debugger
        const input = e.target;
        const parentStarDOM = ($(input).parent().closest('.star'));
        const parentEditDOM = ($(input).parent().closest('.icon-edit'));
        const starElement = parentStarDOM[0];
        const editElement = parentEditDOM[0];
        if(starElement){
            const starClases = starElement.classList;
            const categoriaId =  Number(starElement.getAttribute('data-categoria-id'));
            actualizarFavoritoCategoria(categoriaId);
            let dataCategoriaIx = dataCategorias.findIndex( e => e.id === categoriaId );
            if(starClases.contains('selected')){
                //  const categoriaId =  Number(starElement.getAttribute('data-categoria-id');
                starClases.remove('selected');
                let index = favoritos.findIndex( e => e === categoriaId);
                favoritos.splice(index,1);
                dataCategorias[dataCategoriaIx].favorito =  false;
            }else{
                starClases.add('selected');
                const categoriaId =  starElement.getAttribute('data-categoria-id');
                !favoritos.includes('categoriaId') ? favoritos.push(Number(categoriaId)) : null;
                dataCategorias[dataCategoriaIx].favorito =  true;
            }
            obtenerCategoriasPlantillas(dataCategorias);
        }
        else if(editElement){

            debugger
            const nombre = editElement.getAttribute("data-nombre");
            const categoriaId = editElement.getAttribute("data-categoria-id");
            const tipoCategoria = Number(editElement.getAttribute("data-tipo"));
            const txtNombre = mdlEditarCat.querySelector('#nombreCategoriaEdit');
            const cbTipoCategoria = mdlEditarCat.querySelectorAll('input[name="cbEditarCategoria"][value="'+ tipoCategoria+'"]');
            txtNombre.value = nombre;

            $('input[name="cbEditarCategoria"]').prop('checked',false)
            $(cbTipoCategoria).prop('checked','true');
            btnEditarCat.setAttribute("data-categoria-id",categoriaId);
            btnEliminarCat.setAttribute("data-categoria-id",categoriaId);
            btnEliminarCat.setAttribute("data-nombre",nombre);
        }
    }
    function rutinaClickListenerEvent(e){
        const input = e.target;
        const parentEditDOM = ($(input).parent().closest('.edit'));
        const parentDeleteDOM = ($(input).parent().closest('.delete'));
        const editElement = parentEditDOM[0];
        const deleteElement = parentDeleteDOM[0];
        const txtNombre = mdlEditarRutina.querySelector('#nombreRutinaEdit');
        let id,nombre,semanas;
        let categoriaId = btnNuevaRutina.getAttribute('data-categoria-id');
        if(editElement) {
            console.log(editElement);
            nombre = editElement.getAttribute('data-rutina-nombre');
            id = editElement.getAttribute('data-rutina-id');
            txtNombre.value = nombre;
            btnEditarRutina.setAttribute('data-rutina-id',id);
            $(mdlEditarRutina).modal('show');
        }
        if(deleteElement){
            id = deleteElement.getAttribute('data-rutina-id');
            nombre = deleteElement.getAttribute('data-rutina-nombre');
            const obj = {
                id: id
            }
            $.SmartMessageBox({
                title: "<i class='fa fa-2x fa-trash' style='display:flex; align-items: center; margin-right:0.7em;'></i> ¿Está seguro que desea eliminar la rutina "+ nombre + "?",
                buttons: "[No][Si]"
            }, function(e) {
                "Si" == e &&
                $.ajax({
                    url: _ctx + "gestion/rutina-plantilla/eliminar",
                    type: "DELETE",
                    dataType: 'json',
                    blockLoading: false,
                    noOne: true,
                    data: obj,
                    success: function(e) {
                        obtenerRutinas(categoriaId);
                    },
                    error: function(e) {
                        console.log(e)
                    }
                })
            })
            $('.MsgTitle').css('display','flex');
        }
    }
    function searchSvg(path){
        let svg = path;
        while(svg.tagName.toUpperCase() !== "SVG"){
            svg = svg.parentElement;
        }
        return svg;
    }
    function agregarRutina(){
        if( $('#nueva_rutina_pred_frm').valid()){
            const nombreRotulo = $('#nombreRutina').val();
            const semanas = $('#semanasRutina').val();
            const dias = Number($('#diasRutina').val())*7;
            const id = btnNuevaRutina.getAttribute('data-categoria-id');
            const obj = {
                nombre : nombreRotulo,
                totalSemanas : semanas,
                dias : semanas*7,
                anios : Math.floor(semanas*7/365),
                meses : Math.floor(semanas/4),
                categoriaPlantilla : id
            }
            console.log(obj);
            $.ajax({
                type: 'POST',
                url: _ctx + 'gestion/rutina-plantilla/agregar',
                dataType:'json',
                contentType: 'application/json',
                blockLoading: false,
                noOne: true,
                data : JSON.stringify(obj),
                success: (s) =>{
                    obtenerRutinas(id);
                    $(mdlAgregarRutina).modal('hide');
                    $("html, body").animate({ scrollTop: $(document).height()}, 1000);
                    document.getElementById("nueva_rutina_pred_frm").reset();
                },
                error: (xhr) =>{

                    const mensaje = xhr.responseJSON.message;
                    $.smallBox({
                        title: "RUNFIT",
                        content: '<p>'+mensaje+'</p>',
                        timeout: 4500,
                        color:  '#cc4d4d',
                        icon: "fa fa-exclamation-circle"
                    })

                },
                complete: (c) =>{
                }
            });
        }
    }
    function actualizarRutina() {
        if ($('#editar_rutina_pred_frm').valid()) {
            const nombreRotulo = $('#nombreRutinaEdit').val();
            const id = btnEditarRutina.getAttribute('data-rutina-id');
            const categoriaId = btnNuevaRutina.getAttribute('data-categoria-id');
            const obj = {
                id: id,
                nombre: nombreRotulo,
                categoriaPlantilla: categoriaId
            }
            $.ajax({
                type: 'PUT',
                url: _ctx + 'gestion/rutina-plantilla/actualizar',
                dataType: 'json',
                contentType: 'application/json',
                blockLoading: false,
                noOne: true,
                data: JSON.stringify(obj),
                success: (s) => {
                    obtenerRutinas(categoriaId);
                    $(mdlEditarRutina).modal('hide');
                },
                error: (e) => {
                },
                complete: (c) => {
                }
            });
        }
    }
    function obtenerRutinas(catId){
        $.ajax({
            type: 'GET',
            url: _ctx + 'gestion/rutina-plantilla/listar',
            data: { catId: catId
            },
            dataType:'json',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: (data) => {
                generarRutinasCategoriaDOM(data);
                currentRutinasData = data;
            },
            error: (e) =>{
            },
            complete: (c) =>{
            }
        });
    }
    function generarRutinasCategoriaDOM(dataRutina){
        const ulListadoRutinas = document.getElementsByClassName('list-plan')[0];
        const mensaje = document.querySelector('section#info .mensaje-no-data');
        mensaje ? mensaje.parentNode.removeChild(mensaje) : null;
        ulListadoRutinas.innerHTML ="";
        if(dataRutina.length > 0) {
            dataRutina.forEach( (element) =>{
                const rutina = htmlStringToElement(`
                                       <li class="col-md-4">
                                        <img class="plantilla svg" src="/img/iconos-trainers/icon_leyenda.svg"> ${element.nombre.toUpperCase()}
                                        <a class="edit" data-rutina-id="${element.id}" data-rutina-sem="${element.totalSemanas}" data-rutina-nombre="${element.nombre}"><img class="svg" src="/img/iconos-trainers/icon_edit.svg"></a>
                                        <a class="delete" data-rutina-id="${element.id}" data-rutina-sem="${element.totalSemanas}" data-rutina-nombre="${element.nombre}"><img class="svg" src="/img/iconos-trainers/icon_trash.svg"></a>
                                       </li>
          `);
                ulListadoRutinas.appendChild(rutina);
            })
            imgtoSvgEvent();
        }else{
            let buscador = $('#inpSearch').val();
            let mensaje;
            if(buscador.length > 0)
            {
                mensaje = htmlStringToElement(`
                                    <p class="mensaje-no-data"> No se encontró resultados para su búsqueda
                                    </p>
                   `);
            }else{
                mensaje = htmlStringToElement(`
                                    <p class="mensaje-no-data"> No cuenta con alguna plantilla asociada a esta categoría.
                                       Dele click al botón de Agregar para comenzar a crearla.
                                    </p>
                   `);
            }
            dvListaRutinas.appendChild(mensaje);
        }
    }
    function constraintsValidation()
    {
        $('#nueva_categoria_frm').validate({
            rules:{
                nombreCategoria : {
                    required: true,
                    rangelength: [1, 30]
                },
                cbNuevaCategoria :{
                    required: true
                }
            }

        });
        $('#editar_categoria_frm').validate({
            rules:{
                nombreCategoriaEdit : {
                    required: true,
                    rangelength: [1, 30]

                } , cbEditarCategoria :{
                    required: true
                }
            }
        });
        $('#nueva_rutina_pred_frm').validate({
            rules:{
                nombreRutina : {
                    required: true,
                    maxlength : 30
                },
                semanasRutina : {
                    required: true,
                    range: [6, 84]
                }
            }
        });
        $('#editar_rutina_pred_frm').validate({
            rules:{
                nombreRutinaEdit :{
                    required: true,
                    maxlength : 30
                }
            }


        });
    }
    function searchRutinaEvent(filterInp){
        if(filterInp.data) {
            let filterText = $('#inpSearch').val().toUpperCase();
            const filteredData = currentRutinasData.filter( (el,index) => el.nombre.toUpperCase().indexOf(filterText) > -1);
            generarRutinasCategoriaDOM(filteredData);
        }else{
            generarRutinasCategoriaDOM(currentRutinasData);
        }
    }


</script>
</body>
</html>
